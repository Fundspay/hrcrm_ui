<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="keyword" content="" />
    <meta name="author" content="Fundsroom" />
    <!--! The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags !-->
    <!--! BEGIN: Apps Title-->
    <title>Fundsroom HR || CO</title>
    <!--! END:  Apps Title-->
    <!--! BEGIN: Favicon-->
    <link rel="shortcut icon" type="image/x-icon" href="./../assets/images/FundsAuditLogo.png" />
    <!--! END: Favicon-->
    <!--! BEGIN: Bootstrap CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/bootstrap.min.css" />
    <!--! END: Bootstrap CSS-->
    <!--! BEGIN: Vendors CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/daterangepicker.min.css" />
    <!--! END: Vendors CSS-->
    <!--! BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify-data.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/quill.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2-theme.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/daterangepicker.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <script>
        function setStickyColumns() {
            const table = document.getElementById("leadsTable");
            if (!table) return;

            const stickyCols = 3;
            let leftOffsets = [];

            let total = 0;
            const firstRow = table.querySelector("thead tr:first-child");
            for (let i = 0; i < stickyCols; i++) {
                const th = firstRow.querySelector(`th:nth-child(${i + 1})`);
                if (th) {
                    leftOffsets[i] = total;
                    total += th.offsetWidth;
                }
            }

            requestAnimationFrame(() => {
                const headerRows = table.querySelectorAll("thead tr");
                let cumulativeTop = 0;

                headerRows.forEach(row => {
                    const rowHeight = row.offsetHeight;

                    row.querySelectorAll("th").forEach(th => {
                        th.style.position = "sticky";
                        th.style.top = cumulativeTop + "px";
                        th.style.background = "#fff";
                        th.style.zIndex = 12;
                    });

                    for (let i = 0; i < stickyCols; i++) {
                        const th = row.querySelector(`th:nth-child(${i + 1})`);
                        if (th) {
                            th.style.left = leftOffsets[i] + "px";
                            th.style.zIndex = 16;
                        }
                    }

                    cumulativeTop += rowHeight;
                });

                const rows = table.querySelectorAll("tbody tr");
                rows.forEach(row => {
                    for (let i = 0; i < stickyCols; i++) {
                        const td = row.querySelector(`td:nth-child(${i + 1})`);
                        if (td) {
                            td.style.position = "sticky";
                            td.style.left = leftOffsets[i] + "px";
                            td.style.background = "#fff";
                            td.style.zIndex = 6;
                        }
                    }
                });
            });
        }

        window.addEventListener("load", setStickyColumns);
        window.addEventListener("resize", setStickyColumns);
    </script>

    <script>
        function setStickyColumns2() {
            const table = document.getElementById("leadsTable2");
            if (!table) return;

            const stickyCols = 3; // adjust how many columns stay sticky
            let leftOffsets = [];

            let total = 0;
            const firstRow = table.querySelector("thead tr:first-child");
            for (let i = 0; i < stickyCols; i++) {
                const th = firstRow.querySelector(`th:nth-child(${i + 1})`);
                if (th) {
                    leftOffsets[i] = total;
                    total += th.offsetWidth;
                }
            }

            requestAnimationFrame(() => {
                const headerRows = table.querySelectorAll("thead tr");
                let cumulativeTop = 0;

                headerRows.forEach(row => {
                    const rowHeight = row.offsetHeight;

                    row.querySelectorAll("th").forEach(th => {
                        th.style.position = "sticky";
                        th.style.top = cumulativeTop + "px";
                        th.style.background = "#fff";
                        th.style.zIndex = 12;
                    });

                    for (let i = 0; i < stickyCols; i++) {
                        const th = row.querySelector(`th:nth-child(${i + 1})`);
                        if (th) {
                            th.style.left = leftOffsets[i] + "px";
                            th.style.zIndex = 16;
                        }
                    }

                    cumulativeTop += rowHeight;
                });

                const rows = table.querySelectorAll("tbody tr");
                rows.forEach(row => {
                    for (let i = 0; i < stickyCols; i++) {
                        const td = row.querySelector(`td:nth-child(${i + 1})`);
                        if (td) {
                            td.style.position = "sticky";
                            td.style.left = leftOffsets[i] + "px";
                            td.style.background = "#fff";
                            td.style.zIndex = 6;
                        }
                    }
                });
            });
        }

        window.addEventListener("load", setStickyColumns2);
        window.addEventListener("resize", setStickyColumns2);
    </script>

    <script>
        function setStickyColumns3() {
            const table = document.getElementById("leadsTable3");
            if (!table) return;

            const stickyCols = 3; // number of columns to keep sticky
            let leftOffsets = [];

            let total = 0;
            const firstRow = table.querySelector("thead tr:first-child");
            for (let i = 0; i < stickyCols; i++) {
                const th = firstRow.querySelector(`th:nth-child(${i + 1})`);
                if (th) {
                    leftOffsets[i] = total;
                    total += th.offsetWidth;
                }
            }

            requestAnimationFrame(() => {
                const headerRows = table.querySelectorAll("thead tr");
                let cumulativeTop = 0;

                headerRows.forEach(row => {
                    const rowHeight = row.offsetHeight;

                    row.querySelectorAll("th").forEach(th => {
                        th.style.position = "sticky";
                        th.style.top = cumulativeTop + "px";
                        th.style.background = "#fff";
                        th.style.zIndex = 12;
                    });

                    for (let i = 0; i < stickyCols; i++) {
                        const th = row.querySelector(`th:nth-child(${i + 1})`);
                        if (th) {
                            th.style.left = leftOffsets[i] + "px";
                            th.style.zIndex = 16;
                        }
                    }

                    cumulativeTop += rowHeight;
                });

                const rows = table.querySelectorAll("tbody tr");
                rows.forEach(row => {
                    for (let i = 0; i < stickyCols; i++) {
                        const td = row.querySelector(`td:nth-child(${i + 1})`);
                        if (td) {
                            td.style.position = "sticky";
                            td.style.left = leftOffsets[i] + "px";
                            td.style.background = "#fff";
                            td.style.zIndex = 6;
                        }
                    }
                });
            });
        }

        window.addEventListener("load", setStickyColumns3);
        window.addEventListener("resize", setStickyColumns3);
    </script>

    <!--! END: Custom CSS-->
    <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
    <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
    <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Navigation Manu !-->
    <!--! ================================================================ !-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <nav class="nxl-navigation">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="index.html" class="b-brand">
                    <img src="./../assets/images/FundsAuditText.png" alt="" class="logo logo-lg" />
                    <img src="./../assets/images/FundsAuditLogo.png" alt="" class="logo logo-sm" />
                </a>
            </div>
            <div class="navbar-content">
                <ul class="nxl-navbar">
                    <li class="nxl-item nxl-caption">
                        <label>Navigation</label>
                    </li>
                    <li class="nxl-item">
                        <a href="profile.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-user"></i></span>
                            <span class="nxl-mtext">My Profile</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="targets.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-activity"></i></span>
                            <span class="nxl-mtext">My Targets</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="CO.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-user-plus"></i></span>
                            <span class="nxl-mtext">CO (Connect)</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="RE.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-share-2"></i></span>
                            <span class="nxl-mtext">RE (Reach)</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="R.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-file-text"></i></span>
                            <span class="nxl-mtext">R (Resume)</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="I.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-briefcase"></i></span>
                            <span class="nxl-mtext">I (Interview)</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="S.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-check-circle"></i></span>
                            <span class="nxl-mtext">S (Selection)</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="K.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-flag"></i></span>
                            <span class="nxl-mtext">K (Kick off)</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>

                    <!-- <li class="nxl-item nxl-hasmenu">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-airplay"></i></span>
                            <span class="nxl-mtext">Dashboard</span><span class="nxl-arrow"><i
                                    class="feather-chevron-right"></i></span>
                        </a>
                        <ul class="nxl-submenu">
                            <li class="nxl-item"><a class="nxl-link" href="CO.html">CO (Connect)</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="RE.html">RE (Reach)</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="RE.html">R (Resume)</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="RE.html">I (Interview)</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="RE.html">S (Selection)</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="RE.html">K (Kick off)</a></li>
                        </ul>
                    </li> -->
                    <li class="nxl-item">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-bar-chart-2"></i></span>
                            <span class="nxl-mtext">My Performance</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>
                    <li class="nxl-item">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-log-out"></i></span>
                            <span class="nxl-mtext">Logout</span><span class="nxl-arrow"><i></i></span>
                        </a>
                    </li>

                    <!-- Admin Page Link (Hidden by Default) -->
                    <li class="nxl-item nxl-hasmenu" id="adminPageLink" style="display: none;">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-settings"></i></span>
                            <span class="nxl-mtext">Admin Page</span><span class="nxl-arrow"><i
                                    class="feather-chevron-right"></i></span>
                        </a>
                        <ul class="nxl-submenu">
                            <li class="nxl-item"><a class="nxl-link" href="admin.html">Dashboard Analysis - Edit</a>
                            </li>
                            <li class="nxl-item"><a class="nxl-link" href="analysis-edit.html">HR Analysis - Edit</a>
                            </li>
                        </ul>
                    </li>
                </ul>

                <div class="card text-center">
                    <div class="card-body">
                        <i class="feather-briefcase fs-4 text-dark"></i>
                        <h6 class="mt-4 text-dark fw-bolder">Welcome to FundsRoom</h6>
                        <p class="fs-11 my-3 text-dark">
                            FundsRoom is your trusted financial partner, offering seamless solutions for managing
                            investments, loans, and business funds with ease.
                        </p>
                        <a href="https://www.fundsroom.com/" class="btn btn-primary text-dark w-100"
                            style="margin-bottom: 10%;">Fundsroom</a>
                        <a href="https://play.google.com/store/apps/details?id=com.fundsroom.fundsaudit&hl=en_IN"
                            class="btn btn-success text-light w-100">Download FundsAudit</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <!--! ================================================================ !-->
    <!--! [End]  Navigation Manu !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Header !-->
    <!--! ================================================================ !-->
    <header class="nxl-header">
        <div class="header-wrapper">
            <!--! [Start] Header Left !-->
            <div class="header-left d-flex align-items-center gap-4">
                <!--! [Start] nxl-head-mobile-toggler !-->
                <a href="javascript:void(0);" class="nxl-head-mobile-toggler" id="mobile-collapse">
                    <div class="hamburger hamburger--arrowturn">
                        <div class="hamburger-box">
                            <div class="hamburger-inner"></div>
                        </div>
                    </div>
                </a>
                <!--! [Start] nxl-head-mobile-toggler !-->
                <!--! [Start] nxl-navigation-toggle !-->
                <div class="nxl-navigation-toggle">
                    <a href="javascript:void(0);" id="menu-mini-button">
                        <i class="feather-align-left"></i>
                    </a>
                    <a href="javascript:void(0);" id="menu-expend-button" style="display: none">
                        <i class="feather-arrow-right"></i>
                    </a>
                </div>
                <!--! [End] nxl-navigation-toggle !-->
                <!--! [Start] nxl-lavel-mega-menu-toggle !-->
                <!-- <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
                    <a href="javascript:void(0);" id="nxl-lavel-mega-menu-open">
                        <i class="feather-align-left"></i>
                    </a>
                </div> -->
                <!--! [End] nxl-lavel-mega-menu-toggle !-->
                <!--! [Start] nxl-lavel-mega-menu !-->
                <div class="nxl-drp-link nxl-lavel-mega-menu">
                    <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
                        <a href="javascript:void(0)" id="nxl-lavel-mega-menu-hide">
                            <i class="feather-arrow-left me-2"></i>
                            <span>Back</span>
                        </a>
                    </div>
                    <!--! [Start] nxl-lavel-mega-menu-wrapper !-->
                    <div class="nxl-lavel-mega-menu-wrapper d-flex gap-3">
                        <!--! [Start] nxl-h-item nxl-mega-menu !-->
                        <div class="dropdown nxl-h-item nxl-mega-menu">
                            <!-- <a href="javascript:void(0);" class="btn btn-light-brand" data-bs-toggle="dropdown" data-bs-auto-close="outside"> Mega Menu </a> -->
                            <div class="dropdown-menu nxl-h-dropdown" id="mega-menu-dropdown">
                                <div class="d-lg-flex align-items-start">
                                </div>
                            </div>
                        </div>
                        <!--! [End] nxl-h-item nxl-mega-menu !-->
                    </div>
                    <!--! [End] nxl-lavel-mega-menu-wrapper !-->
                </div>
                <!--! [End] nxl-lavel-mega-menu !-->
            </div>
            <!--! [End] Header Left !-->
            <!--! [Start] Header Right !-->
            <div class="header-right ms-auto">
                <div class="d-flex align-items-center">

                    <!-- Full Screen Switcher -->
                    <!-- <div class="nxl-h-item d-none d-sm-flex">
                        <div class="full-screen-switcher">
                            <a href="javascript:void(0);" class="nxl-head-link me-0"
                                onclick="$('body').fullScreenHelper('toggle');">
                                <i class="feather-maximize maximize"></i>
                                <i class="feather-minimize minimize"></i>
                            </a>
                        </div>
                    </div> -->

                    <!-- Dark/Light Theme Toggle -->
                    <!-- <div class="nxl-h-item dark-light-theme">
                        <a href="javascript:void(0);" class="nxl-head-link me-0 dark-button">
                            <i class="feather-moon"></i>
                        </a>
                        <a href="javascript:void(0);" class="nxl-head-link me-0 light-button" style="display: none">
                            <i class="feather-sun"></i>
                        </a>
                    </div> -->

                    <!-- User Dropdown -->
                    <div class="dropdown nxl-h-item">
                        <a href="javascript:void(0);" data-bs-toggle="dropdown" role="button"
                            data-bs-auto-close="outside">
                            <div class="avatar-text avatar-lg bg-gray-200">
                                <i class="feather-user"></i>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-user-dropdown">
                            <div class="dropdown-header">

                                <section id="user-header">
                                    <div id="user-section" class="user-dropdown"></div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--! [End] Header Right !-->
        </div>
    </header>
    <!--! ================================================================ !-->
    <!--! [End] Header !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container">
        <div class="nxl-content">
            <!-- [ page-header ] start -->
            <div class="page-header">
                <div class="page-header-left d-flex align-items-center">
                    <!-- <div class="page-header-title">
                        <h5 class="m-b-10">Dashboard</h5>
                    </div> -->
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="CO.html">Home</a></li>
                        <li class="breadcrumb-item">Reach</li>
                    </ul>
                </div>
                <div class="page-header-right ms-auto">
                    <div class="page-header-right-items">
                        <div class="d-flex d-md-none">
                            <a href="javascript:void(0)" class="page-header-right-close-toggle">
                                <i class="feather-arrow-left me-2"></i>
                                <span>Back</span>
                            </a>
                        </div>
                    </div>
                    <!-- <div class="d-md-none d-flex align-items-center">
                        <a href="javascript:void(0)" class="page-header-right-open-toggle">
                            <i class="feather-align-right fs-20"></i>
                        </a>
                    </div> -->
                </div>
                <!-- <div class="position-relative border-bottom">
                    <label for="excelUpload" class="dropdown-item upload-trigger" style="cursor:pointer;">
                        <span class="btn btn-icon" data-bs-toggle="tooltip" data-bs-trigger="hover"
                            title="Upload Excel files (Less than 5MB)">
                            <i class="feather-upload"></i> Upload College Data
                        </span>
                    </label>
                    <input type="file" id="excelUpload" accept=".csv,.xls,.xlsx" style="display:none;">

                </div> -->
                <div class="date-picker-container" style="margin-left: 1%;">
                    <input type="text" id="dateRangePicker" class="form-control" placeholder="Select date or range"
                        style="max-width:220px;" />
                </div>
            </div>
            <!-- [ page-header ] end -->
            <!-- [ Main Content ] start -->
            <div class="main-content">
                <div class="row">
                    <!-- Total Calls -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Follow ups</div>
                                <div class="d-flex flex-column align-items-start lh-base">
                                    <h3><span id="totalFollowups">0</span>/<span id="targetFollowups">0</span></h3>
                                    <span id="followupsPercent" class="fs-11 text-muted">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resumes received -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Resumes received</div>
                                <div class="d-flex flex-column align-items-start lh-base">
                                    <h3><span id="totalResumes">0</span>/<span id="targetResumes">0</span></h3>
                                    <span id="resumesPercent" class="fs-11 text-muted">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sending in 1-2 days -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Sending in 1-2 days</div>
                                <div class="d-flex flex-column align-items-start lh-base">
                                    <h3><span id="sendingCount">0</span></h3>
                                    <!-- <span id="sendingPercent" class="fs-11 text-muted">0%</span> -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Delay -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Delay</div>
                                <div class="d-flex flex-column align-items-start lh-base">
                                    <h3><span id="delayCount">0</span></h3>
                                    <!-- <span id="delayPercent" class="fs-11 text-muted">0%</span> -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- No Response -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">No Response</div>
                                <div class="d-flex flex-column align-items-start lh-base">
                                    <h3><span id="noresponseCount">0</span></h3>
                                    <!-- <span id="noresponsePercent" class="fs-11 text-muted">0%</span> -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Unprofessional -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Unprofessional</div>
                                <div class="d-flex flex-column align-items-start lh-base">
                                    <h3><span id="unprofessionalCount">0</span></h3>
                                    <!-- <span id="unprofessionalPercent" class="fs-11 text-muted">0%</span> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- <div class="col-xxl-12 col-lg-12 col-md-12 d-flex justify-content-center align-items-center">
                    <div class="card stretch stretch-full" id="remainingCallsCard"
                        style="width: 100%; max-width: 1400px;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center fs-18 fw-medium mb-3">
                                <div>
                                    Remaining Follow Ups: <span id="remainingCalls" style="color:white;">0</span>
                                </div>
                                <div>
                                    Achieved Percentage: <span id="achievementPercent2">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->

                <div class="col-12">
                    <div class="card stretch stretch-full">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title" id="reSheetTitle">
                                    INDIVIDUAL RE SHEET (Total colleges: <span id="collegeCount2">0</span>)
                                </h5>
                            </div>
                            <div class="card-header-action">
                                <div class="search-wrapper" id="searchWrapper2">
                                    <button id="searchToggle2" class="search-icon">
                                        <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png" alt="Search"
                                            width="20" height="20">
                                    </button>
                                    <div class="search-bar" id="searchBar2">
                                        <input type="text" id="searchInput2" class="form-control"
                                            placeholder="Search..." oninput="filterTable2()">
                                    </div>
                                </div>

                                <div data-bs-toggle="tooltip" title="Maximize/Minimize">
                                    <a href="javascript:void(0);" class="avatar-xs" data-bs-toggle="expand">
                                        <i class="feather-maximize maximize" style="font-size: 15px;"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="card-body custom-card-action p-0">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover mb-0" id="leadsTable2">
                                    <thead class="table-light">
                                        <tr class="border-b">
                                            <th>Delete</th>
                                            <th>SR</th>
                                            <th>College Name</th>
                                            <th>Co-ordinator Name</th>
                                            <th>Mobile Number</th>
                                            <th>Email</th>
                                            <th>State</th>
                                            <th>City</th>
                                            <th>Course</th>
                                            <th>Connected by</th>
                                            <th>Date of connect</th>
                                            <th>Call Response</th>
                                            <th>Type of INT</th>
                                            <th>Detailed Response</th>
                                            <th>Follow up by</th>
                                            <th>Follow up date</th>
                                            <th>Response of follow up</th>
                                            <th>No. of resumes</th>
                                            <th>Date of resume</th>
                                            <th>Expected response date</th>
                                            <th>Follow up mail</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <ul class="list-unstyled d-flex align-items-center gap-2 mb-0 pagination-common-style"
                                    id="pagination2">
                                </ul>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary" onclick="printTable2()">
                                        <i class="bi bi-printer"></i> Print
                                    </button>
                                    <button class="btn btn-success" onclick="exportToExcel2()">
                                        <i class="bi bi-file-earmark-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    const userData5 = JSON.parse(sessionStorage.getItem("user_data"));
                    if (userData5 && userData5.name) {
                        document.getElementById("reSheetTitle").innerHTML =
                            `${userData5.name}'s RE Sheet (Total colleges: <span id="collegeCount2">0</span>)`;
                    }
                </script>

                <style>
                    #dateRangePicker2::placeholder {
                        font-weight: 700;
                        color: #000;
                        opacity: 1;
                    }

                    .search-wrapper {
                        position: relative;
                        display: flex;
                        align-items: center;
                    }

                    .search-icon {
                        background: none;
                        border: none;
                        cursor: pointer;
                        margin-right: 8px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 4px;
                    }

                    .search-bar {
                        display: none;
                    }

                    .search-bar.active {
                        display: block;
                    }

                    #searchInput2 {
                        padding: 6px 10px;
                        border: 1px solid #ccc;
                        border-radius: 6px;
                    }
                </style>

                <script>
                    const searchToggle2 = document.getElementById("searchToggle2");
                    const searchBar2 = document.getElementById("searchBar2");
                    const searchWrapper2 = document.getElementById("searchWrapper2");

                    searchToggle2.addEventListener("click", () => {
                        const isActive = searchBar2.classList.toggle("active");

                        if (isActive) {
                            document.getElementById("searchInput2").focus();
                            if (typeof loadTableData2 === "function") loadTableData2();
                        }
                    });

                    document.addEventListener("click", (event) => {
                        if (!searchWrapper2.contains(event.target)) {
                            searchBar2.classList.remove("active");
                        }
                    });
                </script>


                <div class="col-xxl-12">
                    <div class="card stretch stretch-full overflow-hidden">
                        <div class="bg-success text-white">
                            <div class="p-4 d-flex justify-content-between align-items-center">
                                <h5 class="card-title" id="reSheetTitle3">
                                    RESUME ANALYTICS
                                </h5>
                            </div>
                            <div id="conversion-statistic-bar-chart"></div>
                        </div>
                        <div class="card-body">
                            <h6 class="mb-3">Resumes sent</h6>
                            <ul class="list-group" id="jdList">
                                <!-- Dates and JD counts will be appended here -->
                            </ul>
                        </div>
                    </div>
                </div>

                <script>
                    const userData7 = JSON.parse(sessionStorage.getItem("user_data"));
                    if (userData7 && userData7.name) {
                        document.getElementById("reSheetTitle3").innerHTML =
                            `RESUME ANALYTICS OF (${userData7.name})`;
                    }
                </script>

                <hr style="border: none; border-top: 10px dotted #000000; margin-top: 10px;">

                <div class="row">

                    <div class="col-12">
                        <div class="card stretch stretch-full">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title">RE MASTER SHEET (Total colleges: <span id="collegeCount">
                                            0</span>)</h5>
                                </div>
                                <div class="card-header-action">
                                    <!-- <div data-bs-toggle="tooltip" title="Refresh">
                                        <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning"
                                            onclick="loadTableData()"> </a>
                                    </div> -->
                                    <div class="search-wrapper" id="searchWrapper">
                                        <button id="searchToggle" class="search-icon">
                                            <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png"
                                                alt="Search" width="20" height="20">
                                        </button>
                                        <div class="search-bar" id="searchBar">
                                            <input type="text" id="searchInput" class="form-control"
                                                placeholder="Search..." oninput="filterTable()">
                                        </div>
                                    </div>

                                    <div data-bs-toggle="tooltip" title="Maximize/Minimize">
                                        <a href="javascript:void(0);" class="avatar-xs" data-bs-toggle="expand">
                                            <i class="feather-maximize maximize" style="font-size: 15px;"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="card-body custom-card-action p-0">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover mb-0" id="leadsTable">
                                        <thead class="table-light">
                                            <tr class="border-b">
                                                <th>Delete</th>
                                                <th>SR</th>
                                                <th>College Name</th>
                                                <th>Co-ordinator Name</th>
                                                <th>Mobile Number</th>
                                                <th>Email</th>
                                                <th>State</th>
                                                <th>City</th>
                                                <th>Course</th>
                                                <th>Connected by</th>
                                                <th>Date of connect</th>
                                                <th>Call Response</th>
                                                <th>Type of INT</th>
                                                <th>Detailed Response</th>
                                                <th>Follow up by</th>
                                                <th>Follow up date</th>
                                                <th>Response of follow up</th>
                                                <th>No. of resumes</th>
                                                <th>Date of resume</th>
                                                <th>Expected response date</th>
                                                <th>Follow up mail</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Rows dynamically injected here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <ul class="list-unstyled d-flex align-items-center gap-2 mb-0 pagination-common-style"
                                        id="pagination">
                                        <!-- Pagination links will be dynamically populated here -->
                                    </ul>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" onclick="printTable()">
                                            <i class="bi bi-printer"></i> Print
                                        </button>
                                        <button class="btn btn-success" onclick="exportToExcel()">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <style>
                        #dateRangePicker2::placeholder {
                            font-weight: 700;
                            color: #000;
                            opacity: 1;
                        }

                        .search-wrapper {
                            position: relative;
                            display: flex;
                            align-items: center;
                        }

                        .search-icon {
                            background: none;
                            border: none;
                            cursor: pointer;
                            margin-right: 8px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 4px;
                        }

                        .search-bar {
                            display: none;
                        }

                        .search-bar.active {
                            display: block;
                        }

                        #searchInput {
                            padding: 6px 10px;
                            border: 1px solid #ccc;
                            border-radius: 6px;
                        }
                    </style>

                    <script>
                        const searchToggle = document.getElementById("searchToggle");
                        const searchBar = document.getElementById("searchBar");
                        const searchWrapper = document.getElementById("searchWrapper");

                        searchToggle.addEventListener("click", () => {
                            const isActive = searchBar.classList.toggle("active");

                            if (isActive) {
                                document.getElementById("searchInput").focus();

                                loadTableData();
                                loadTableData2();
                            }
                        });

                        document.addEventListener("click", (event) => {
                            if (!searchWrapper.contains(event.target)) {
                                searchBar.classList.remove("active");
                            }
                        });
                    </script>

                    <style>
                        .table-responsive {
                            overflow-x: auto;
                            position: relative;
                        }

                        #leadsTable {
                            border-collapse: collapse;
                            width: max-content;
                            font-family: 'Inter', sans-serif;
                            font-size: 14px;
                            background: #fff;
                            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                            border-radius: 8px;
                        }

                        .column-filter {
                            display: inline-block !important;
                            width: 100%;
                            margin-top: 4px;
                        }


                        #leadsTable th {
                            font-weight: 600;
                            text-align: left;
                            padding: 8px 12px;
                            border-bottom: 2px solid #e5e7eb;
                            position: sticky;
                            top: 0;
                            z-index: 10;
                        }

                        #leadsTable th:nth-child(-n+3) {
                            background: #fff;
                            color: #000;
                            z-index: 15;
                        }

                        #leadsTable th:nth-child(n+4) {
                            background: #fff;
                            color: #000;
                            font-weight: bold;
                            font-size: 13px;
                        }

                        #leadsTable td {
                            vertical-align: middle;
                            padding: 8px 12px;
                            white-space: nowrap;
                            border-bottom: 1px solid #f1f5f9;
                        }

                        #leadsTable tr:nth-child(even) td {
                            background: #fafafa;
                        }

                        #leadsTable tr:hover td {
                            background: #f1f5ff;
                        }

                        #leadsTable th:nth-child(-n+3),
                        #leadsTable td:nth-child(-n+3) {
                            position: sticky;
                            left: 0;
                            z-index: 5;
                            border-right: 1px solid #dee2e6;
                            background: #fff;
                            font-size: 13px;
                        }

                        #leadsTable input,
                        #leadsTable select {
                            display: none;
                            width: 100%;
                            font-size: 14px;
                            padding: 6px 8px;
                            border: 1px solid #cbd5e1;
                            border-radius: 6px;
                            background: #fff;
                        }

                        #leadsTable td.editing input,
                        #leadsTable td.editing select {
                            display: block;
                        }

                        #leadsTable td span {
                            display: inline-block;
                            width: 100%;
                            min-height: 22px;
                            font-size: 14px;
                            cursor: pointer;
                            color: #1e293b;
                        }

                        #leadsTable td.editing {
                            background: #ffffff;
                            box-shadow: inset 0 0 0 2px #fff;
                        }
                    </style>

                    <style>
                        .table-responsive {
                            overflow-x: auto;
                            position: relative;
                        }

                        #leadsTable2 {
                            border-collapse: collapse;
                            width: max-content;
                            font-family: 'Inter', sans-serif;
                            font-size: 14px;
                            background: #fff;
                            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                            border-radius: 8px;
                        }

                        .column-filter2 {
                            display: inline-block !important;
                            width: 100%;
                            margin-top: 4px;
                        }

                        #leadsTable2 th {
                            font-weight: 600;
                            text-align: left;
                            padding: 8px 12px;
                            border-bottom: 2px solid #e5e7eb;
                            position: sticky;
                            top: 0;
                            z-index: 10;
                        }

                        #leadsTable2 th:nth-child(-n+3) {
                            background: #fff;
                            color: #000;
                            z-index: 15;
                        }

                        #leadsTable2 th:nth-child(n+4) {
                            background: #fff;
                            color: #000;
                            font-weight: bold;
                            font-size: 13px;
                        }

                        #leadsTable2 td {
                            vertical-align: middle;
                            padding: 8px 12px;
                            white-space: nowrap;
                            border-bottom: 1px solid #f1f5f9;
                        }

                        #leadsTable2 tr:nth-child(even) td {
                            background: #fafafa;
                        }

                        #leadsTable2 tr:hover td {
                            background: #f1f5ff;
                        }

                        #leadsTable2 th:nth-child(-n+3),
                        #leadsTable2 td:nth-child(-n+3) {
                            position: sticky;
                            left: 0;
                            z-index: 5;
                            border-right: 1px solid #dee2e6;
                            background: #fff;
                            font-size: 13px;
                        }

                        #leadsTable2 input,
                        #leadsTable2 select {
                            display: none;
                            width: 100%;
                            font-size: 14px;
                            padding: 6px 8px;
                            border: 1px solid #cbd5e1;
                            border-radius: 6px;
                            background: #fff;
                        }

                        #leadsTable2 td.editing input,
                        #leadsTable2 td.editing select {
                            display: block;
                        }

                        #leadsTable2 td span {
                            display: inline-block;
                            width: 100%;
                            min-height: 22px;
                            font-size: 14px;
                            cursor: pointer;
                            color: #1e293b;
                        }

                        #leadsTable2 td.editing {
                            background: #ffffff;
                            box-shadow: inset 0 0 0 2px #fff;
                        }
                    </style>

                    <!-- Calendar Component -->
                    <!-- <div class="col-4 flex-fill calendar-container">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="calendar">
                                    <div class="calendar-header">
                                        <button id="prevMonth">&lt;</button>
                                        <h2 id="currentMonthYear">March 2025</h2>
                                        <button id="nextMonth">&gt;</button>
                                    </div>
                                    <div class="calendar-grid">
                                        <div class="calendar-weekdays">
                                            <div>MON</div>
                                            <div>TUE</div>
                                            <div>WED</div>
                                            <div>THU</div>
                                            <div>FRI</div>
                                            <div>SAT</div>
                                            <div>SUN</div>
                                        </div>
                                        <div class="calendar-days" id="calendarDays"></div>
                                    </div>
                                </div>
                                <div id="errorMessage" class="text-danger mt-2" style="display: none;">
                                    Failed to fetch data. Please try again.
                                </div>
                                <div class="selected-range mt-3">
                                    <strong>Selected:</strong>
                                    <span id="selectedRange"></span>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <!-- [Project Calendar] end -->

                </div>
                <hr style="border: none; border-top: 10px dotted #000000; margin-top: 10px;">

                <div class="row" style="margin-bottom: 3%;">

                    <div class="date-picker-container d-flex justify-content-center"
                        style="margin-top: 0%; margin-bottom: 0%; margin-right:2%;">
                        <input type="text" id="dateRangePicker2" class="form-control text-center fw-bold"
                            placeholder="Select date or range"
                            style="max-width:220px; font-weight:700; color:#000; opacity:1;" />
                    </div>

                    <style>
                        #dateRangePicker2::placeholder {
                            font-weight: 700;
                            color: #000;
                            opacity: 1;
                        }
                    </style>
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title" id="reSheetTitle2">
                            INDIVIDUAL ANALYTICS
                        </h5>
                    </div>

                    <div class="row g-3">
                        <!-- Card 1 -->
                        <div class="col-md-6">
                            <a href="tables/resumes_recieved.html" class="text-decoration-none">
                                <div class="card bg-success text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <p class="m-0">Resumes Received:</p>
                                                <h4 id="totalResumes2" style="color: white;">0</h4>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Card 2 -->
                        <div class="col-md-6">
                            <a href="tables/sending.html" class="text-decoration-none">
                                <div class="card bg-warning text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <p class="m-0">Sending in 1-2 days:</p>
                                                <h4 id="sendingCount2" style="color: white;">0</h4>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Card 3 -->
                        <div class="col-md-4">
                            <a href="tables/delay.html" class="text-decoration-none">
                                <div class="card bg-primary text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <p class="m-0">Delay:</p>
                                                <h4 id="delayCount2" style="color: white;">0</h4>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Card 4 -->
                        <div class="col-md-4">
                            <a href="tables/no_response.html" class="text-decoration-none">
                                <div class="card bg-secondary text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <p class="m-0">No Response:</p>
                                                <h4 id="noresponseCount2" style="color: white;">0</h4>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Card 5 -->
                        <div class="col-md-4">
                            <a href="tables/unprofessional.html" class="text-decoration-none">
                                <div class="card bg-danger text-white h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <p class="m-0">Unprofessional:</p>
                                                <h4 id="unprofessionalCount2" style="color: white;">0</h4>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <script>
                        const userData6 = JSON.parse(sessionStorage.getItem("user_data"));
                        if (userData6 && userData6.name) {
                            document.getElementById("reSheetTitle2").innerHTML =
                                `${userData6.name}'s ANALYTICS`;
                        }
                    </script>

                </div>
                <hr style="border: none; border-top: 10px dotted #000000; margin-top: 10px;">

                <div class="col-12 flex-fill">
                    <div class="card stretch stretch-full">
                        <!-- Header -->
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title">FOLLOW UP DETAILS</h5>
                            </div>

                            <div class="card-header-action d-flex align-items-center gap-2">
                                <!-- Month & Year dropdown -->
                                <div class="month-dropdown d-flex align-items-center gap-2">
                                    <select id="monthSelect3" class="form-select form-select-sm"
                                        onchange="setSelectedMonthYear3()">
                                        <option value=""></option>
                                    </select>
                                    <select id="yearSelect3" class="form-select form-select-sm"
                                        onchange="setSelectedMonthYear3()">
                                        <option value=""></option>
                                    </select>
                                    <span id="selectedMonthDisplay3" class="badge bg-primary"
                                        style="display:none;"></span>
                                </div>

                                <div class="search-wrapper3" id="searchWrapper3">
                                    <button id="searchToggle3" class="search-icon">
                                        <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png" alt="Search"
                                            width="20" height="20">
                                    </button>
                                    <div class="search-bar3" id="searchBar3">
                                        <input type="text" id="searchInput3" class="form-control"
                                            placeholder="Search..." oninput="filterTable3()">
                                    </div>
                                </div>

                                <!-- Expand -->
                                <div data-bs-toggle="tooltip" title="Maximize/Minimize">
                                    <a href="javascript:void(0);" class="avatar-xs" data-bs-toggle="expand">
                                        <i class="feather-maximize maximize" style="font-size: 15px;"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Body -->
                        <div class="card-body custom-card-action p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0" id="leadsTable3">
                                    <thead>
                                        <tr class="border-b">
                                            <th></th> <!-- For Delete Btn -->
                                            <th>SR</th>
                                            <th>College Name</th>
                                            <th>Co-ordinator Name</th>
                                            <th>Mobile Number</th>
                                            <th>Email</th>
                                            <th>State</th>
                                            <th>City</th>
                                            <th>Course</th>
                                            <th>Connected by</th>
                                            <th>Date of connect</th>
                                            <th>Call Response</th>
                                            <th>Type of INT</th>
                                            <th>Detailed Response</th>
                                            <th>Follow up by</th>
                                            <th>Follow up date</th>
                                            <th>Follow up response</th>
                                            <th>No. of resumes</th>
                                            <th>Resume date</th>
                                            <th>Expected response date</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <ul class="list-unstyled d-flex align-items-center gap-2 mb-0 pagination-common-style"
                                    id="pagination3"></ul>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary" onclick="printTable3()">
                                        <i class="bi bi-printer"></i> Print
                                    </button>
                                    <button class="btn btn-success" onclick="exportToExcel3()">
                                        <i class="bi bi-file-earmark-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <style>
                    #dateRangePicker2::placeholder {
                        font-weight: 700;
                        color: #000;
                        opacity: 1;
                    }

                    .search-wrapper3 {
                        position: relative;
                        display: flex;
                        align-items: center;
                    }

                    .search-icon {
                        background: none;
                        border: none;
                        cursor: pointer;
                        margin-right: 8px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 4px;
                    }

                    .search-bar3 {
                        display: none;
                    }

                    .search-bar3.active {
                        display: block;
                    }

                    #searchInput3 {
                        padding: 6px 10px;
                        border: 1px solid #ccc;
                        border-radius: 6px;
                    }
                </style>

                <script>
                    const searchToggle3 = document.getElementById("searchToggle3");
                    const searchBar3 = document.getElementById("searchBar3");
                    const searchWrapper3 = document.getElementById("searchWrapper3");

                    searchToggle3.addEventListener("click", () => {
                        const isActive = searchBar3.classList.toggle("active");

                        if (isActive) {
                            document.getElementById("searchInput3").focus();

                            loadTableData3();
                        }
                    });

                    document.addEventListener("click", (event) => {
                        if (!searchWrapper3.contains(event.target)) {
                            searchBar3.classList.remove("active");
                        }
                    });
                </script>

                <style>
                    .table-responsive {
                        overflow-x: auto;
                        position: relative;
                    }

                    #leadsTable3 {
                        border-collapse: collapse;
                        width: max-content;
                        font-family: 'Inter', sans-serif;
                        font-size: 14px;
                        background: #fff;
                        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                        border-radius: 8px;
                    }

                    .column-filter3 {
                        display: inline-block !important;
                        width: 100%;
                        margin-top: 4px;
                    }

                    #leadsTable3 th {
                        font-weight: 600;
                        text-align: left;
                        padding: 8px 12px;
                        border-bottom: 2px solid #e5e7eb;
                        position: sticky;
                        top: 0;
                        z-index: 10;
                    }

                    #leadsTable3 th:nth-child(-n+3) {
                        background: #fff;
                        color: #000;
                        z-index: 15;
                    }

                    #leadsTable3 th:nth-child(n+4) {
                        background: #fff;
                        color: #000;
                        font-weight: bold;
                        font-size: 13px;
                    }

                    #leadsTable3 td {
                        vertical-align: middle;
                        padding: 8px 12px;
                        white-space: nowrap;
                        border-bottom: 1px solid #f1f5f9;
                    }

                    #leadsTable3 tr:nth-child(even) td {
                        background: #fafafa;
                    }

                    #leadsTable3 tr:hover td {
                        background: #f1f5ff;
                    }

                    #leadsTable3 th:nth-child(-n+3),
                    #leadsTable3 td:nth-child(-n+3) {
                        position: sticky;
                        left: 0;
                        z-index: 5;
                        border-right: 1px solid #dee2e6;
                        background: #fff;
                        font-size: 13px;
                    }

                    #leadsTable3 input,
                    #leadsTable3 select {
                        display: none;
                        width: 100%;
                        font-size: 14px;
                        padding: 6px 8px;
                        border: 1px solid #cbd5e1;
                        border-radius: 6px;
                        background: #fff;
                    }

                    #leadsTable3 td.editing input,
                    #leadsTable3 td.editing select {
                        display: block;
                    }

                    #leadsTable3 td span {
                        display: inline-block;
                        width: 100%;
                        min-height: 22px;
                        font-size: 14px;
                        cursor: pointer;
                        color: #1e293b;
                    }

                    #leadsTable3 td.editing {
                        background: #ffffff;
                        box-shadow: inset 0 0 0 2px #fff;
                    }
                </style>


                <style>
                    .card-header-action {
                        gap: 10px;
                    }

                    .month-dropdown select {
                        min-width: 160px;
                        border-radius: 8px;
                        border: 1px solid #ddd;
                        background-color: #f8f9fa;
                        padding: 4px 8px;
                        font-size: 14px;
                        transition: all 0.2s ease-in-out;
                    }

                    .month-dropdown select:hover {
                        border-color: #0d6efd;
                        background-color: #fff;
                        box-shadow: 0 0 6px rgba(13, 110, 253, 0.2);
                    }

                    .search-bar .input-group {
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        overflow: hidden;
                        transition: box-shadow 0.2s;
                    }

                    .search-bar .input-group:focus-within {
                        box-shadow: 0 0 6px rgba(13, 110, 253, 0.2);
                        border-color: #0d6efd;
                    }

                    .search-bar input {
                        border: none;
                        outline: none;
                        font-size: 14px;
                    }
                </style>


                <!-- [ Main Content ] end -->
            </div>
            <!-- [ Footer ] start -->
            <footer class="footer">
                <p class="fs-11 text-muted fw-medium text-uppercase mb-0 copyright">
                    <span>Copyright Fundsroom ©</span>
                    <script>
                        document.write(new Date().getFullYear());
                    </script>
                </p>
                <div class="d-flex align-items-center gap-4">
                    <!-- <a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Help</a>
					<a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Terms</a>
					<a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Privacy</a> -->
                </div>
            </footer>
            <style>
                .flatpickr-calendar,
                .flatpickr-calendar * {
                    font-family: 'Inter', sans-serif !important;
                    font-size: 14px;
                }

                .flatpickr-months .flatpickr-month {
                    font-weight: 600;
                    color: #155fcf;
                }

                .flatpickr-weekday {
                    color: #1e293b;
                    font-weight: 500;
                }

                .flatpickr-day.selected,
                .flatpickr-day.startRange,
                .flatpickr-day.endRange {
                    background: #155fcf !important;
                    color: #fff !important;
                    border-radius: 6px;
                }

                .flatpickr-day.inRange {
                    background: #e0ebff;
                    color: #155fcf;
                }

                .flatpickr-day.today {
                    border: 1px solid #155fcf;
                }

                #dateRangePicker {
                    font-family: 'Inter', sans-serif;
                    font-size: 14px;
                    border-radius: 6px;
                    border: 1px solid #cbd5e1;
                    padding: 6px 10px;
                    color: #1e293b;
                }
            </style>
            <!-- [ Footer ] end -->
    </main>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Theme Customizer !-->
    <!--! ================================================================ !-->

    <!--! ================================================================ !-->
    <!--! [End] Theme Customizer !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! Footer Script !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Vendors JS !-->
    <script src="./../assets/vendors/js/vendors.min.js"></script>
    <!-- vendors.min.js {always must need to be top} -->
    <script src="./../assets/vendors/js/daterangepicker.min.js"></script>
    <script src="./../assets/vendors/js/apexcharts.min.js"></script>
    <script src="./../assets/vendors/js/circle-progress.min.js"></script>
    <script src="./../assets/vendors/js/jquery.calendar.min.js"></script>
    <script src="./../assets/vendors/js/select2.min.js"></script>
    <script src="./../assets/vendors/js/select2-active.min.js"></script>
    <script src="./../assets/js/common-init.min.js"></script>
    <script src="./../assets/vendors/js/lslstrength.min.js"></script>
    <!--! END: Vendors JS !-->
    <!--! BEGIN: Apps Init  !-->
    <script src="./../assets/js/reports-project-init.min.js"></script>
    <script src="./../assets/js/widgets-charts-init.min.js"></script>
    <script src="./../assets/js/widgets-miscellaneous-init.min.js"></script>
    <!--! END: Apps Init !-->
    <!--! BEGIN: Theme Customizer  !-->
    <script src="./../assets/js/theme-customizer-init.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
        var userData = JSON.parse(sessionStorage.getItem("user_data"));
        console.log(userData);

        const apiBase = "https://fundsaudit.com/api/v1/cosheet";

        const dropdowns = {
            city: [],
            state: [],
            course: ["MBA", "PGDM", "MBA+PGDM", "BBA/BCOM", "OTHERS"],
            connectedBy: [],
            callResponse: ["connected", "not answered", "busy", "switch off", "invalid"],
            internshipType: ["fulltime", "sip", "liveproject", "wip", "others"],
            detailedResponse: [
                "Send JD", "Not Interested", "January", "February", "March", "April",
                "May", "June", "July", "August", "September", "October", "November",
                "December", "Cut the call"
            ],
            followUpResponse: ["resumes received",
                "sending in 1-2 days",
                "delayed",
                "no response",
                "unprofessional"]
        };

        const colorMap = {
            callResponse: {
                "connected": "#28a745",
                "not answered": "#dc3545",
                "busy": "#ffc107",
                "switch off": "#0d6efd",
                "invalid": "#6c757d"
            },
            internshipType: {
                "fulltime": "#28a745",
                "sip": "#0d6efd",
                "liveproject": "#ffc107",
                "wip": "#0d6efd",
                "others": "#adb5bd"
            },
            detailedResponse: {
                "send jd": "#28a745",
                "not interested": "#dc3545",
                "cut the call": "#ffc107",
                "january": "#0d6efd",
                "february": "#0d6efd",
                "march": "#0d6efd",
                "april": "#0d6efd",
                "may": "#0d6efd",
                "june": "#0d6efd",
                "july": "#0d6efd",
                "august": "#0d6efd",
                "september": "#0d6efd",
                "october": "#0d6efd",
                "november": "#0d6efd",
                "december": "#0d6efd"
            }
        };

        let citiesData = [];
        let tableData = [];
        let filteredData = [];
        const rowsPerPage = 10;
        let currentPage = 1;

        function loadCities() {
            return fetch("/templates/cities.json")
                .then(res => res.json())
                .then(data => {
                    citiesData = data;
                    dropdowns.state = [...new Set(data.map(item => item.state))];
                })
                .catch(err => console.error("Failed to load cities.json:", err));
        }

        function loadTableData() {
            $.ajax({
                url: apiBase + "/list/jdsent",
                method: "GET",
                success: function (res) {
                    console.log("master sheet:", res);
                    if (res.success && res.users) {
                        tableData = res.data.map((row, index) => ({
                            sno: index + 1,
                            id: row.id,
                            collegeName: row.collegeName || "",
                            coordinatorName: row.coordinatorName || "",
                            mobileNumber: row.mobileNumber || "",
                            emailId: row.emailId || "",
                            state: row.state || "",
                            city: row.city || "",
                            course: row.course || "",
                            connectedBy: row.connectedBy || "",
                            dateOfConnect: row.dateOfConnect || "",
                            callResponse: row.callResponse || "",
                            internshipType: row.internshipType || "",
                            detailedResponse: row.detailedResponse || "",
                            followUpBy: row.followUpBy || "",
                            followUpDate: row.followUpDate || "",
                            followUpResponse: row.followUpResponse || "",
                            resumeCount: row.resumeCount || "",
                            resumeDate: row.resumeDate || "",
                            expectedResponseDate: row.expectedResponseDate || ""
                        }));

                        dropdowns.connectedBy = res.users.map(u => u.firstName);
                        dropdowns.connectedBy.push("Other");
                        console.log("ConnectedBy options:", dropdowns.connectedBy);

                        sessionStorage.setItem("users_list", JSON.stringify(res.users));

                        const totalColleges = tableData.length;
                        document.getElementById("collegeCount").textContent = totalColleges;

                        filteredData = [...tableData];
                        renderTable();
                        renderPagination();
                        renderColumnFilters();
                    }
                }
            });
        }

        function renderTable() {
            let tbody = $("#leadsTable tbody");
            tbody.empty();

            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const rows = filteredData.slice(start, end);

            rows.forEach((row) => {
                let tr = `<tr data-id="${row.id}">
            <td>
                <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
            <td>${row.sno}</td>

            <!-- keep all these NON-editable / dropdown as before -->
            <td>${row.collegeName || ""}</td>
            <td>${row.coordinatorName || ""}</td>
            <td>${row.mobileNumber || ""}</td>
            <td>${row.emailId || ""}</td>
            <td>${row.state || ""}</td>
            <td>${row.city || ""}</td>
            <td>${row.course || ""}</td>
            <td>${row.connectedBy || ""}</td>
            <td>${formatDate(row.dateOfConnect) || ""}</td>
            <td>${row.callResponse || ""}</td>
            <td>${row.internshipType || ""}</td>
            <td>${row.detailedResponse || ""}</td>
            ${makeDropdownCell("followUpBy", row.followUpBy || "", null, dropdowns.connectedBy)}
            ${makeDateCell("followUpDate", row.followUpDate || "")}
            ${makeDropdownCell("followUpResponse", row.followUpResponse || "", null, dropdowns.followUpResponse)}
            ${makeNumberCell("resumeCount", row.resumeCount || "")}
            ${makeDateCell("resumeDate", row.resumeDate || "")}
            ${makeDateCell("expectedResponseDate", row.expectedResponseDate || "")}
            <td>
                <button class="btn btn-sm btn-success send-mail" data-id="${row.id}" title="Send JD">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </td>
            </tr>`;
                tbody.append(tr);
            });

            attachCellEvents();
            attachSendMailEvents();
            setStickyColumns();
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            const pagination = $("#pagination");
            pagination.empty();

            const visiblePageCount = 3;
            let startPage = Math.max(currentPage - 1, 1);
            let endPage = startPage + visiblePageCount - 1;
            if (endPage > totalPages) {
                endPage = totalPages;
                startPage = Math.max(endPage - visiblePageCount + 1, 1);
            }

            const prevDisabled = currentPage === 1 ? 'disabled' : '';
            const nextDisabled = currentPage === totalPages ? 'disabled' : '';

            pagination.append(`<li><a href="javascript:void(0);" class="${prevDisabled}" onclick="changePage(${currentPage - 1})">&laquo;</a></li>`);

            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage ? "active" : "";
                pagination.append(`<li><a href="javascript:void(0);" class="${active}" onclick="changePage(${i})">${i}</a></li>`);
            }

            pagination.append(`<li><a href="javascript:void(0);" class="${nextDisabled}" onclick="changePage(${currentPage + 1})">&raquo;</a></li>`);
        }

        window.changePage = function (page) {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderTable();
            renderPagination();
        };

        function renderColumnFilters() {
            const headerRow = $("#leadsTable thead tr.filters");
            headerRow.remove();

            let filterRow = "<tr class='filters'>";
            $("#leadsTable thead tr:first th").each(function (i, th) {
                if (i === 0 || i === 1 || i === 20) {
                    filterRow += "<th></th>";
                } else {
                    filterRow += `<th>
                <select class="column-filter form-select form-select-sm" data-index="${i}">
                    <option value="">All</option>
                </select>
            </th>`;
                }
            });
            filterRow += "</tr>";
            $("#leadsTable thead").append(filterRow);

            populateColumnFilterOptions();

            $(".column-filter").off("change").on("change", function () {
                applyFilters();
            });
        }

        function populateColumnFilterOptions() {
            $("#leadsTable thead .column-filter").each(function () {
                const index = $(this).data("index");

                const colName = $("#leadsTable thead th").eq(index).text().trim().toLowerCase();

                const isDateColumn =
                    colName.includes("date") ||
                    colName.includes("response") ||
                    colName.includes("created");

                const isNumericColumn =
                    colName.includes("no. of resumes") || colName.includes("number of resumes");

                let values = [...new Set(tableData.map(row => {
                    let v = Object.values(row)[index];
                    if (v === null || v === undefined || v === "") return "";

                    if (typeof v === "string") v = v.trim();

                    if (isNumericColumn) {
                        v = parseInt(v, 10);
                        if (isNaN(v)) return "";
                    }

                    return v;
                }))];

                values = values.filter(v => v !== "" && v !== null && v !== undefined);

                values.sort((a, b) => {
                    if (isDateColumn) {
                        const da = new Date(a), db = new Date(b);
                        if (!isNaN(da) && !isNaN(db)) return da - db;
                    }
                    if (isNumericColumn) {
                        return a - b;
                    }
                    return a.toString().localeCompare(b.toString());
                });

                values.forEach(v => {
                    let displayText = v;
                    if (isDateColumn) {
                        const d = new Date(v);
                        if (!isNaN(d)) {
                            displayText = d.toLocaleDateString("en-GB", {
                                day: "numeric",
                                month: "long",
                                year: "numeric"
                            });
                        }
                    }
                    $(this).append(`<option value="${v}">${displayText}</option>`);
                });
            });
        }

        function applyFilters() {
            const filters = {};
            $(".column-filter").each(function () {
                const index = $(this).data("index");
                const value = $(this).val();
                if (value) filters[index] = value;
            });

            $("#leadsTable tbody tr").each(function () {
                let show = true;
                $(this).find("td").each(function (i, td) {
                    if (filters[i]) {
                        const colName = $("#leadsTable thead th").eq(i).text().trim().toLowerCase();
                        let cellText = $(td).text().trim();

                        if (colName.includes("no. of resumes") || colName.includes("number of resumes")) {

                            if (parseInt(cellText, 10) !== parseInt(filters[i], 10)) {
                                show = false;
                            }
                        } else {
                            if (cellText !== filters[i]) {
                                show = false;
                            }
                        }
                    }
                });
                $(this).toggle(show);
            });
        }
        function applyFilters() {
            filteredData = [...tableData];
            $("#leadsTable thead .column-filter").each(function () {
                const value = $(this).val();
                const index = $(this).data("index");
                if (value) {
                    filteredData = filteredData.filter(row => {
                        const cellValue = Object.values(row)[index] || "";

                        return cellValue.toLowerCase() === value.toLowerCase();
                    });
                }
            });
            currentPage = 1;
            renderTable();
            renderPagination();
        }

        function makeCell(field, value) {
            let displayValue = value || "";
            return `<td data-field="${field}">
            <span>${displayValue}</span>
            <input type="text" value="${displayValue}">
        </td>`;
        }

        function makeNumberCell(field, value) {
            let displayValue = value || "";
            return `<td data-field="${field}">
            <span>${displayValue}</span>
            <input type="number" value="${displayValue}">
        </td>`;
        }

        function makeDateCell(field, value) {
            let displayValue = formatDate(value);
            let rawValue = value ? new Date(value).toISOString().split("T")[0] : "";
            return `<td data-field="${field}">
            <span>${displayValue}</span>
            <input type="text" class="date-picker" value="${rawValue}">
        </td>`;
        }

        function makeDropdownCell(field, selectedValue, stateFilter = null, optionsList = null) {
            let options = optionsList || dropdowns[field] || [];

            function capitalize(str) {
                return str.replace(/\b\w/g, c => c.toUpperCase());
            }

            let displaySelected = selectedValue ? capitalize(selectedValue) : "";

            let html = `<td data-field="${field}">
            <span style="font-weight:bold;">${displaySelected}</span>
            <select class="form-control select2">`;

            html += `<option value="" ${!selectedValue ? "selected" : ""}></option>`;
            options.forEach(opt => {
                let sel = (opt === selectedValue) ? "selected" : "";
                html += `<option value="${opt}" ${sel}>${capitalize(opt)}</option>`;
            });

            html += `</select></td>`;
            return html;
        }

        function formatDate(dateStr) {
            if (!dateStr) return "";
            let date = new Date(dateStr);
            if (isNaN(date)) return dateStr;
            return date.toLocaleDateString("en-GB", {
                day: "numeric",
                month: "long",
                year: "numeric"
            });
        }

        function attachCellEvents() {
            $("#leadsTable td").off("dblclick").on("dblclick", function () {
                let td = $(this);
                td.addClass("editing");
                td.find("input,select").focus();
            });

            $("#leadsTable td[data-field='mobileNumber']").off("dblclick").on("dblclick", function (e) {
                e.preventDefault();
                let td = $(this);
                td.addClass("editing");
                td.find("input").focus();
            });

            $("#leadsTable td input, #leadsTable td select")
                .off("blur change")
                .on("blur change", function () {

                    if ($(this).hasClass("date-picker")) return;

                    let td = $(this).closest("td");
                    let tr = $(this).closest("tr");
                    let id = tr.data("id");
                    let field = td.data("field");
                    let value = $(this).val();

                    function capitalize(str) {
                        return str.replace(/\b\w/g, c => c.toUpperCase());
                    }

                    if ($(this).is("select")) {
                        let displayText = capitalize(value);
                        let bgColor = "";
                        if (colorMap[field] && value) {
                            bgColor = colorMap[field][value.toLowerCase()] || "";
                        }
                        td.css("background-color", bgColor);
                        td.find("span").css("color", "black").css("font-weight", "bold").text(displayText);
                    } else {
                        td.find("span").text(value);
                    }
                    td.removeClass("editing");

                    let payload = {};
                    payload[field] = value;

                    let userData = JSON.parse(sessionStorage.getItem("user_data"));
                    if (userData && userData.user_id) {
                        payload["userId"] = userData.user_id;
                    }

                    $.ajax({
                        url: `https://fundsaudit.com/api/v1/resumedetails/update/` + id,
                        method: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(payload),
                        success: function (res) {
                            console.log("Payload:", payload);
                            console.log("Updated:", res);

                            if (field === "state") {
                                const cityTd = tr.find("td[data-field='city']");
                                const newCityDropdown = makeDropdownCell("city", "", value);
                                cityTd.replaceWith(newCityDropdown);
                                attachCellEvents();
                            }
                        },
                        error: function (err) {
                            console.error("Update failed", err);
                            console.log("Payload:", payload);
                        }
                    });
                });

            $(".date-picker").each(function () {
                const input = $(this);
                input.flatpickr({
                    dateFormat: "Y-m-d",
                    onChange: function (selectedDates, dateStr) {
                        if (!dateStr) return;

                        let td = input.closest("td");
                        let tr = input.closest("tr");
                        let id = tr.data("id");
                        let field = td.data("field");
                        let value = new Date(dateStr).toISOString().split("T")[0];

                        td.find("span").text(formatDate(value));
                        td.removeClass("editing");

                        let payload = {};
                        payload[field] = value;

                        let userData = JSON.parse(sessionStorage.getItem("user_data"));
                        if (userData && userData.user_id) {
                            payload["userId"] = userData.user_id;
                        }

                        $.ajax({
                            url: `https://fundsaudit.com/api/v1/resumedetails/update/` + id,
                            method: "PUT",
                            contentType: "application/json",
                            data: JSON.stringify(payload),
                            success: function (res) {
                                console.log("Updated:", res);
                            },
                            error: function (err) {
                                console.error("Update failed", err);
                            }
                        });
                    }
                });
            });
        }

        function attachSendMailEvents() {
            $(".send-mail").off("click").on("click", function () {
                const id = $(this).data("id");

                Swal.fire({
                    title: "Are you sure?",
                    text: "Do you want to send the Follow up mail?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonText: "Yes, Send",
                    cancelButtonText: "Cancel"
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: "Sending...",
                            text: "Please wait while the follow up mail is being sent",
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        $.ajax({
                            url: "https://fundsaudit.com/api/v1/resumedetails/send-followup-email/" + id,
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({ cc: [], bcc: [], userId: userData.user_id }),
                            success: function (res) {
                                Swal.fire({
                                    icon: "success",
                                    title: "Mail Sent!",
                                    text: "The Follow up mail was sent successfully."
                                });
                            },
                            error: function (err) {
                                Swal.fire({
                                    icon: "error",
                                    title: "Error",
                                    text: "Failed to send the Follow up mail."
                                });
                            }
                        });
                    }
                });
            });
        }

        window.filterTable = function () {
            const value = $("#searchInput").val().toLowerCase().trim();
            if (!value) {
                renderTable();
                renderPagination();
                return;
            }

            const filtered = tableData.filter((row) =>
                Object.values(row).some((field) => {
                    const plainText = $('<div>').html(field).text().toLowerCase().trim();
                    return plainText.includes(value);
                })
            );

            const tbody = $("#leadsTable tbody");
            tbody.empty();
            filtered.forEach((row, index) => {
                const tr = `<tr data-id="${row.id}">
                    <td>
                    <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
                <td>${row.sno}</td>

                <!-- keep all these NON-editable / dropdown as before -->
                <td>${row.collegeName || ""}</td>
                <td>${row.coordinatorName || ""}</td>
                <td>${row.mobileNumber || ""}</td>
                <td>${row.emailId || ""}</td>
                <td>${row.state || ""}</td>
                <td>${row.city || ""}</td>
                <td>${row.course || ""}</td>
                <td>${row.connectedBy || ""}</td>
                <td>${row.dateOfConnect || ""}</td>
                <td>${row.callResponse || ""}</td>
                <td>${row.internshipType || ""}</td>
                <td>${row.detailedResponse || ""}</td>
                ${makeDropdownCell("followUpBy", row.followUpBy || "", null, dropdowns.connectedBy)}
                ${makeDateCell("followUpDate", row.followUpDate || "")}
                ${makeDropdownCell("followUpResponse", row.followUpResponse || "", null, dropdowns.followUpResponse)}
                ${makeNumberCell("resumeCount", row.resumeCount || "")}
                ${makeDateCell("resumeDate", row.resumeDate || "")}
                ${makeDateCell("expectedResponseDate", row.expectedResponseDate || "")}
                <td>
                    <button class="btn btn-sm btn-success send-mail" data-id="${row.id}" title="Send JD">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </td>
                </tr>`;
                tbody.append(tr);
            });

            $("#pagination").hide();
            attachCellEvents();
            attachSendMailEvents();
        };

        window.printTable = function () {
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print Table</title></head><body>');
            printWindow.document.write($("#leadsTable")[0].outerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        };

        window.exportToExcel = function () {
            const headers = [
                "S No.",
                "College Name",
                "Coordinator Name",
                "Mobile Number",
                "Email ID",
                "State",
                "City",
                "Course",
                "Connected By",
                "Date of Connect",
                "Call Response",
                "Internship Type",
                "Detailed Response",
                "Follow up by",
                "Follow up date",
                "Follow up response",
                "Resume count",
                "Resume date",
                "Expected response date"
            ];

            const data = [headers];

            tableData.forEach((row, index) => {
                data.push([
                    index + 1,
                    row.collegeName,
                    row.coordinatorName,
                    row.mobileNumber,
                    row.emailId,
                    row.state,
                    row.city,
                    row.course,
                    row.connectedBy,
                    row.dateOfConnect,
                    row.callResponse,
                    row.internshipType,
                    row.detailedResponse,
                    row.followUpBy,
                    row.followUpDate,
                    row.followUpResponse,
                    row.resumeCount,
                    row.resumeCount,
                    row.expectedResponseDate
                ]);
            });

            const worksheet = XLSX.utils.aoa_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "CollegeDetails");
            XLSX.writeFile(workbook, "CollegeDetails_All.xlsx");
        };

        $(document).ready(function () {
            loadCities().then(() => {
                loadTableData();
            });
        });
    </script>

    <script>
        var userData2 = JSON.parse(sessionStorage.getItem("user_data"));
        console.log(userData2);

        const apiBase2 = "https://fundsaudit.com/api/v1/cosheet";

        const dropdowns2 = {
            city: [],
            state: [],
            course: ["MBA", "PGDM", "MBA+PGDM", "BBA/BCOM", "OTHERS"],
            connectedBy: [],
            callResponse: ["connected", "not answered", "busy", "switch off", "invalid"],
            internshipType: ["fulltime", "sip", "liveproject", "wip", "others"],
            detailedResponse: [
                "Send JD", "Not Interested", "January", "February", "March", "April",
                "May", "June", "July", "August", "September", "October", "November",
                "December", "Cut the call"
            ],
            followUpResponse: ["resumes received",
                "sending in 1-2 days",
                "delayed",
                "no response",
                "unprofessional"]
        };

        const colorMap2 = {
            callResponse: {
                "connected": "#28a745",
                "not answered": "#dc3545",
                "busy": "#ffc107",
                "switch off": "#0d6efd",
                "invalid": "#6c757d"
            },
            internshipType: {
                "fulltime": "#28a745",
                "sip": "#0d6efd",
                "liveproject": "#ffc107",
                "wip": "#0d6efd",
                "others": "#adb5bd"
            },
            detailedResponse: {
                "send jd": "#28a745",
                "not interested": "#dc3545",
                "cut the call": "#ffc107",
                "january": "#0d6efd",
                "february": "#0d6efd",
                "march": "#0d6efd",
                "april": "#0d6efd",
                "may": "#0d6efd",
                "june": "#0d6efd",
                "july": "#0d6efd",
                "august": "#0d6efd",
                "september": "#0d6efd",
                "october": "#0d6efd",
                "november": "#0d6efd",
                "december": "#0d6efd"
            }
        };

        let citiesData2 = [];
        let tableData2 = [];
        let filteredData2 = [];
        const rowsPerPage2 = 10;
        let currentPage2 = 1;

        function loadCities2() {
            return fetch("/templates/cities.json")
                .then(res => res.json())
                .then(data => {
                    citiesData2 = data;
                    dropdowns2.state = [...new Set(data.map(item => item.state))];
                })
                .catch(err => console.error("Failed to load cities.json:", err));
        }

        function loadTableData2() {
            $.ajax({
                url: `https://fundsaudit.com/api/v1/resumedetails/followup-data/${userData2.user_id}`,
                method: "GET",
                success: function (res) {
                    console.log("Individual data:", res);
                    if (res.success && res.users) {
                        tableData2 = res.data.map((row, index) => ({
                            sno: index + 1,
                            id: row.id,
                            collegeName: row.collegeName || "",
                            coordinatorName: row.coordinatorName || "",
                            mobileNumber: row.mobileNumber || "",
                            emailId: row.emailId || "",
                            state: row.state || "",
                            city: row.city || "",
                            course: row.course || "",
                            connectedBy: row.connectedBy || "",
                            dateOfConnect: row.dateOfConnect || "",
                            callResponse: row.callResponse || "",
                            internshipType: row.internshipType || "",
                            detailedResponse: row.detailedResponse || "",
                            followUpBy: row.followUpBy || "",
                            followUpDate: row.followUpDate || "",
                            followUpResponse: row.followUpResponse || "",
                            resumeCount: row.resumeCount || "",
                            resumeDate: row.resumeDate || "",
                            expectedResponseDate: row.expectedResponseDate || ""
                        }));

                        dropdowns2.connectedBy = res.users.map(u => u.firstName);
                        dropdowns2.connectedBy.push("Other");
                        console.log("ConnectedBy options:", dropdowns2.connectedBy);

                        sessionStorage.setItem("users_list2", JSON.stringify(res.users));

                        const totalColleges2 = tableData2.length;
                        document.getElementById("collegeCount2").textContent = totalColleges2;

                        filteredData2 = [...tableData2];
                        renderTable2();
                        renderPagination2();
                        renderColumnFilters2();
                    }
                }
            });
        }

        function renderTable2() {
            let tbody = $("#leadsTable2 tbody");
            tbody.empty();

            const start = (currentPage2 - 1) * rowsPerPage2;
            const end = start + rowsPerPage2;
            const rows = filteredData2.slice(start, end);

            rows.forEach((row) => {
                let tr = `<tr data-id="${row.id}">
                    <td>
                        <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                    <td>${row.sno}</td>

                    <!-- keep all these NON-editable / dropdown as before -->
                    <td>${row.collegeName || ""}</td>
                    <td>${row.coordinatorName || ""}</td>
                    <td>${row.mobileNumber || ""}</td>
                    <td>${row.emailId || ""}</td>
                    <td>${row.state || ""}</td>
                    <td>${row.city || ""}</td>
                    <td>${row.course || ""}</td>
                    <td>${row.connectedBy || ""}</td>
                    <td>${formatDate2(row.dateOfConnect) || ""}</td>
                    <td>${row.callResponse || ""}</td>
                    <td>${row.internshipType || ""}</td>
                    <td>${row.detailedResponse || ""}</td>
                    ${makeDropdownCell2("followUpBy", row.followUpBy || "", null, dropdowns2.connectedBy)}
                    ${makeDateCell2("followUpDate", row.followUpDate || "")}
                    ${makeDropdownCell2("followUpResponse", row.followUpResponse || "", null, dropdowns2.followUpResponse)}
                    ${makeNumberCell2("resumeCount", row.resumeCount || "")}
                    ${makeDateCell2("resumeDate", row.resumeDate || "")}
                    ${makeDateCell2("expectedResponseDate", row.expectedResponseDate || "")}
                    <td>
                        <button class="btn btn-sm btn-success send-mail2" data-id="${row.id}" title="Send JD">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </td>
                    </tr>`;
                tbody.append(tr);
            });

            attachCellEvents2();
            attachSendMailEvents2();
            setStickyColumns2();
        }

        function renderPagination2() {
            const totalPages = Math.ceil(filteredData2.length / rowsPerPage2);
            const pagination = $("#pagination2");
            pagination.empty();

            const visiblePageCount = 3;
            let startPage = Math.max(currentPage2 - 1, 1);
            let endPage = startPage + visiblePageCount - 1;
            if (endPage > totalPages) {
                endPage = totalPages;
                startPage = Math.max(endPage - visiblePageCount + 1, 1);
            }

            const prevDisabled = currentPage2 === 1 ? 'disabled' : '';
            const nextDisabled = currentPage2 === totalPages ? 'disabled' : '';

            pagination.append(`<li><a href="javascript:void(0);" class="${prevDisabled}" onclick="changePage2(${currentPage2 - 1})">&laquo;</a></li>`);

            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage2 ? "active" : "";
                pagination.append(`<li><a href="javascript:void(0);" class="${active}" onclick="changePage2(${i})">${i}</a></li>`);
            }

            pagination.append(`<li><a href="javascript:void(0);" class="${nextDisabled}" onclick="changePage2(${currentPage2 + 1})">&raquo;</a></li>`);
        }

        window.changePage2 = function (page) {
            const totalPages = Math.ceil(filteredData2.length / rowsPerPage2);
            if (page < 1 || page > totalPages) return;
            currentPage2 = page;
            renderTable2();
            renderPagination2();
        };

        function renderColumnFilters2() {
            const headerRow = $("#leadsTable2 thead tr.filters");
            headerRow.remove();

            let filterRow = "<tr class='filters'>";
            $("#leadsTable2 thead tr:first th").each(function (i, th) {
                if (i === 0 || i === 1 || i === 20) {
                    filterRow += "<th></th>";
                } else {
                    filterRow += `<th>
                        <select class="column-filter2 form-select form-select-sm" data-index="${i}">
                            <option value="">All</option>
                        </select>
                    </th>`;
                }
            });
            filterRow += "</tr>";
            $("#leadsTable2 thead").append(filterRow);

            populateColumnFilterOptions2();

            $(".column-filter2").off("change").on("change", function () {
                applyFilters2();
            });
        }

        function populateColumnFilterOptions2() {
            $("#leadsTable2 thead .column-filter2").each(function () {
                const index = $(this).data("index");

                const colName = $("#leadsTable2 thead th").eq(index).text().trim().toLowerCase();

                const isDateColumn =
                    colName.includes("date") ||
                    colName.includes("response") ||
                    colName.includes("created");

                const isNumericColumn =
                    colName.includes("no. of resumes") || colName.includes("number of resumes");

                let values = [...new Set(tableData2.map(row => {
                    let v = Object.values(row)[index];
                    if (v === null || v === undefined || v === "") return "";

                    if (typeof v === "string") v = v.trim();

                    if (isNumericColumn) {
                        v = parseInt(v, 10);
                        if (isNaN(v)) return "";
                    }

                    return v;
                }))];

                values = values.filter(v => v !== "" && v !== null && v !== undefined);

                values.sort((a, b) => {
                    if (isDateColumn) {
                        const da = new Date(a), db = new Date(b);
                        if (!isNaN(da) && !isNaN(db)) return da - db;
                    }
                    if (isNumericColumn) {
                        return a - b;
                    }
                    return a.toString().localeCompare(b.toString());
                });

                values.forEach(v => {
                    let displayText = v;
                    if (isDateColumn) {
                        const d = new Date(v);
                        if (!isNaN(d)) {
                            displayText = d.toLocaleDateString("en-GB", {
                                day: "numeric",
                                month: "long",
                                year: "numeric"
                            });
                        }
                    }
                    $(this).append(`<option value="${v}">${displayText}</option>`);
                });
            });
        }

        function applyFilters2() {
            filteredData2 = [...tableData2];
            $("#leadsTable2 thead .column-filter2").each(function () {
                const value = $(this).val();
                const index = $(this).data("index");
                if (value) {
                    filteredData2 = filteredData2.filter(row => {
                        const cellValue = Object.values(row)[index] || "";

                        return cellValue.toLowerCase() === value.toLowerCase();
                    });
                }
            });
            currentPage2 = 1;
            renderTable2();
            renderPagination2();
        }

        function makeNumberCell2(field, value) {
            let displayValue = value || "";
            return `<td data-field="${field}">
                <span>${displayValue}</span>
                <input type="number" value="${displayValue}">
            </td>`;
        }

        function makeDateCell2(field, value) {
            let displayValue = formatDate2(value);
            let rawValue = value ? new Date(value).toISOString().split("T")[0] : "";
            return `<td data-field="${field}">
                <span>${displayValue}</span>
                <input type="text" class="date-picker2" value="${rawValue}">
            </td>`;
        }

        function makeDropdownCell2(field, selectedValue, stateFilter = null, optionsList = null) {
            let options = optionsList || dropdowns2[field] || [];

            function capitalize(str) {
                return str.replace(/\b\w/g, c => c.toUpperCase());
            }

            let displaySelected = selectedValue ? capitalize(selectedValue) : "";

            let html = `<td data-field="${field}">
                <span style="font-weight:bold;">${displaySelected}</span>
                <select class="form-control select22">`;

            html += `<option value="" ${!selectedValue ? "selected" : ""}></option>`;
            options.forEach(opt => {
                let sel = (opt === selectedValue) ? "selected" : "";
                html += `<option value="${opt}" ${sel}>${capitalize(opt)}</option>`;
            });

            html += `</select></td>`;
            return html;
        }

        function formatDate2(dateStr) {
            if (!dateStr) return "";
            let date = new Date(dateStr);
            if (isNaN(date)) return dateStr;
            return date.toLocaleDateString("en-GB", {
                day: "numeric",
                month: "long",
                year: "numeric"
            });
        }

        function attachCellEvents2() {
            $("#leadsTable2 td").off("dblclick").on("dblclick", function () {
                let td = $(this);
                td.addClass("editing");
                td.find("input,select").focus();
            });

            $("#leadsTable2 td[data-field='mobileNumber']").off("dblclick").on("dblclick", function (e) {
                e.preventDefault();
                let td = $(this);
                td.addClass("editing");
                td.find("input").focus();
            });

            $("#leadsTable2 td input, #leadsTable2 td select")
                .off("blur change")
                .on("blur change", function () {

                    if ($(this).hasClass("date-picker2")) return;

                    let td = $(this).closest("td");
                    let tr = $(this).closest("tr");
                    let id = tr.data("id");
                    let field = td.data("field");
                    let value = $(this).val();

                    function capitalize(str) {
                        return str.replace(/\b\w/g, c => c.toUpperCase());
                    }

                    if ($(this).is("select")) {
                        let displayText = capitalize(value);
                        let bgColor = "";
                        if (colorMap2[field] && value) {
                            bgColor = colorMap2[field][value.toLowerCase()] || "";
                        }
                        td.css("background-color", bgColor);
                        td.find("span").css("color", "black").css("font-weight", "bold").text(displayText);
                    } else {
                        td.find("span").text(value);
                    }
                    td.removeClass("editing");

                    let payload = {};
                    payload[field] = value;

                    let userData2 = JSON.parse(sessionStorage.getItem("user_data"));
                    if (userData2 && userData2.user_id) {
                        payload["userId"] = userData2.user_id;
                    }

                    $.ajax({
                        url: `https://fundsaudit.com/api/v1/resumedetails/update/` + id,
                        method: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(payload),
                        success: function (res) {
                            console.log("Payload2:", payload);
                            console.log("Updated2:", res);

                            if (field === "state") {
                                const cityTd = tr.find("td[data-field='city']");
                                const newCityDropdown = makeDropdownCell2("city", "", value);
                                cityTd.replaceWith(newCityDropdown);
                                attachCellEvents2();
                            }
                        },
                        error: function (err) {
                            console.error("Update2 failed", err);
                            console.log("Payload2:", payload);
                        }
                    });
                });

            $(".date-picker2").each(function () {
                const input = $(this);
                input.flatpickr({
                    dateFormat: "Y-m-d",
                    onChange: function (selectedDates, dateStr) {
                        if (!dateStr) return;

                        let td = input.closest("td");
                        let tr = input.closest("tr");
                        let id = tr.data("id");
                        let field = td.data("field");
                        let value = new Date(dateStr).toISOString().split("T")[0];

                        td.find("span").text(formatDate2(value));
                        td.removeClass("editing");

                        let payload = {};
                        payload[field] = value;

                        let userData2 = JSON.parse(sessionStorage.getItem("user_data"));
                        if (userData2 && userData2.user_id) {
                            payload["userId"] = userData2.user_id;
                        }

                        $.ajax({
                            url: `https://fundsaudit.com/api/v1/resumedetails/update/` + id,
                            method: "PUT",
                            contentType: "application/json",
                            data: JSON.stringify(payload),
                            success: function (res) {
                                console.log("Updated2:", res);
                            },
                            error: function (err) {
                                console.error("Update2 failed", err);
                            }
                        });
                    }
                });
            });
        }

        function attachSendMailEvents2() {
            $(".send-mail2").off("click").on("click", function () {
                const id = $(this).data("id");

                Swal.fire({
                    title: "Are you sure?",
                    text: "Do you want to send the Follow up mail?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonText: "Yes, Send",
                    cancelButtonText: "Cancel"
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: "Sending...",
                            text: "Please wait while the Follow up mail is being sent",
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        $.ajax({
                            url: "https://fundsaudit.com/api/v1/resumedetails/send-followup-email/" + id,
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({ cc: [], bcc: [], userId: userData.user_id }),
                            success: function (res) {
                                Swal.fire({
                                    icon: "success",
                                    title: "Mail Sent!",
                                    text: "The Follow up mail was sent successfully."
                                });
                            },
                            error: function (err) {
                                Swal.fire({
                                    icon: "error",
                                    title: "Error",
                                    text: "Failed to send the Follow up mail."
                                });
                            }
                        });
                    }
                });
            });
        }

        window.filterTable2 = function () {
            const value = $("#searchInput2").val().toLowerCase().trim();
            if (!value) {
                renderTable2();
                renderPagination2();
                return;
            }

            const filtered = tableData2.filter((row) =>
                Object.values(row).some((field) => {
                    const plainText = $('<div>').html(field).text().toLowerCase().trim();
                    return plainText.includes(value);
                })
            );

            const tbody = $("#leadsTable2 tbody");
            tbody.empty();
            filtered.forEach((row, index) => {
                const tr = `<tr data-id="${row.id}">
                    <td>
                    <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
                <td>${row.sno}</td>

                <!-- keep all these NON-editable / dropdown as before -->
                <td>${row.collegeName || ""}</td>
                <td>${row.coordinatorName || ""}</td>
                <td>${row.mobileNumber || ""}</td>
                <td>${row.emailId || ""}</td>
                <td>${row.state || ""}</td>
                <td>${row.city || ""}</td>
                <td>${row.course || ""}</td>
                <td>${row.connectedBy || ""}</td>
                <td>${row.dateOfConnect || ""}</td>
                <td>${row.callResponse || ""}</td>
                <td>${row.internshipType || ""}</td>
                <td>${row.detailedResponse || ""}</td>
                ${makeDropdownCell("followUpBy", row.followUpBy || "", null, dropdowns.connectedBy)}
                ${makeDateCell("followUpDate", row.followUpDate || "")}
                ${makeDropdownCell("followUpResponse", row.followUpResponse || "", null, dropdowns.followUpResponse)}
                ${makeNumberCell("resumeCount", row.resumeCount || "")}
                ${makeDateCell("resumeDate", row.resumeDate || "")}
                ${makeDateCell("expectedResponseDate", row.expectedResponseDate || "")}
                <td>
                    <button class="btn btn-sm btn-success send-mail2" data-id="${row.id}" title="Send JD">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </td>
                </tr>`;
                tbody.append(tr);
            });

            $("#pagination2").hide();
            attachCellEvents2();
            attachSendMailEvents2();
        };

        window.printTable2 = function () {
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print Table</title></head><body>');
            printWindow.document.write($("#leadsTable2")[0].outerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        };

        window.exportToExcel2 = function () {
            const headers = [
                "S No.",
                "College Name",
                "Coordinator Name",
                "Mobile Number",
                "Email ID",
                "State",
                "City",
                "Course",
                "Connected By",
                "Date of Connect",
                "Call Response",
                "Internship Type",
                "Detailed Response",
                "Follow up by",
                "Follow up date",
                "Follow up response",
                "Resume count",
                "Resume date",
                "Expected response date"
            ];

            const data = [headers];

            tableData2.forEach((row, index) => {
                data.push([
                    index + 1,
                    row.collegeName,
                    row.coordinatorName,
                    row.mobileNumber,
                    row.emailId,
                    row.state,
                    row.city,
                    row.course,
                    row.connectedBy,
                    row.dateOfConnect,
                    row.callResponse,
                    row.internshipType,
                    row.detailedResponse,
                    row.followUpBy,
                    row.followUpDate,
                    row.followUpResponse,
                    row.resumeCount,
                    row.resumeCount,
                    row.expectedResponseDate
                ]);
            });

            const worksheet = XLSX.utils.aoa_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "CollegeDetails");
            XLSX.writeFile(workbook, "RE_Individual.xlsx");
        };

        $(document).ready(function () {
            loadCities2().then(() => {
                loadTableData2();
            });
        });
    </script>

    <script>
        var userData3 = JSON.parse(sessionStorage.getItem("user_data"));
        console.log(userData3);

        const apiBase3 = "https://fundsaudit.com/api/v1/cosheet";

        const dropdowns3 = {
            city: [],
            state: [],
            course: ["MBA", "PGDM", "MBA+PGDM", "BBA/BCOM", "OTHERS"],
            connectedBy: [],
            callResponse: ["connected", "not answered", "busy", "switch off", "invalid"],
            internshipType: ["fulltime", "sip", "liveproject", "wip", "others"],
            detailedResponse: [
                "Send JD", "Not Interested", "January", "February", "March", "April",
                "May", "June", "July", "August", "September", "October", "November",
                "December", "Cut the call"
            ],
            followUpResponse: [
                "resumes received",
                "sending in 1-2 days",
                "delayed",
                "no response",
                "unprofessional"
            ]
        };

        const colorMap3 = {
            callResponse: {
                "connected": "#28a745",
                "not answered": "#dc3545",
                "busy": "#ffc107",
                "switch off": "#0d6efd",
                "invalid": "#6c757d"
            },
            internshipType: {
                "fulltime": "#28a745",
                "sip": "#0d6efd",
                "liveproject": "#ffc107",
                "wip": "#0d6efd",
                "others": "#adb5bd"
            },
            detailedResponse: {
                "send jd": "#28a745",
                "not interested": "#dc3545",
                "cut the call": "#ffc107",
                "january": "#0d6efd",
                "february": "#0d6efd",
                "march": "#0d6efd",
                "april": "#0d6efd",
                "may": "#0d6efd",
                "june": "#0d6efd",
                "july": "#0d6efd",
                "august": "#0d6efd",
                "september": "#0d6efd",
                "october": "#0d6efd",
                "november": "#0d6efd",
                "december": "#0d6efd"
            }
        };

        let citiesData3 = [];
        let tableData3 = [];
        let filteredData3 = [];
        const rowsPerPage3 = 10;
        let currentPage3 = 1;

        function loadCities3() {
            return fetch("/templates/cities.json")
                .then(res => res.json())
                .then(data => {
                    citiesData3 = data;
                    dropdowns3.state = [...new Set(data.map(item => item.state))];
                })
                .catch(err => console.error("Failed to load cities.json:", err));
        }

        function loadTableData3() {
            $.ajax({
                url: `https://fundsaudit.com/api/v1/resumedetails/followups/pending`,
                method: "GET",
                success: function (res) {
                    console.log("follow up data table:", res);
                    if (res.success && res.users) {
                        tableData3 = res.data.map((row, index) => ({
                            sno: index + 1,
                            id: row.id,
                            collegeName: row.collegeName || "",
                            coordinatorName: row.coordinatorName || "",
                            mobileNumber: row.mobileNumber || "",
                            emailId: row.emailId || "",
                            state: row.state || "",
                            city: row.city || "",
                            course: row.course || "",
                            connectedBy: row.connectedBy || "",
                            dateOfConnect: row.dateOfConnect || "",
                            callResponse: row.callResponse || "",
                            internshipType: row.internshipType || "",
                            detailedResponse: row.detailedResponse || "",
                            followUpBy: row.followUpBy || "",
                            followUpDate: row.followUpDate || "",
                            followUpResponse: row.followUpResponse || "",
                            resumeCount: row.resumeCount || "",
                            resumeDate: row.resumeDate || "",
                            expectedResponseDate: row.expectedResponseDate || ""
                        }));

                        dropdowns3.connectedBy = res.users.map(u => u.firstName);
                        dropdowns3.connectedBy.push("Other");
                        console.log("ConnectedBy options:", dropdowns3.connectedBy);

                        sessionStorage.setItem("users_list3", JSON.stringify(res.users));

                        if (selectedMonthYear3) {
                            filteredData3 = tableData3.filter(row => {
                                if (!row.followUpDate) return false;
                                let d = new Date(row.followUpDate);
                                if (isNaN(d)) return false;
                                let ym = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}`;
                                return ym === selectedMonthYear3;
                            });
                        } else {
                            filteredData3 = [...tableData3];
                        }

                        renderTable3();
                        renderPagination3();
                        renderColumnFilters3();
                    }
                }
            });
        }

        function renderTable3() {
            let tbody = $("#leadsTable3 tbody");
            tbody.empty();

            const start = (currentPage3 - 1) * rowsPerPage3;
            const end = start + rowsPerPage3;
            const rows = filteredData3.slice(start, end);

            rows.forEach((row) => {
                let tr = `<tr data-id="${row.id}">
                <td>
                    <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
                <td>${row.sno}</td>
                <td>${row.collegeName || ""}</td>
                <td>${row.coordinatorName || ""}</td>
                <td>${row.mobileNumber || ""}</td>
                <td>${row.emailId || ""}</td>
                <td>${row.state || ""}</td>
                <td>${row.city || ""}</td>
                <td>${row.course || ""}</td>
                <td>${row.connectedBy || ""}</td>
                <td>${formatDate3(row.dateOfConnect) || ""}</td>
                <td>${row.callResponse || ""}</td>
                <td>${row.internshipType || ""}</td>
                <td>${row.detailedResponse || ""}</td>
                ${makeDropdownCell3("followUpBy", row.followUpBy || "", null, dropdowns3.connectedBy)}
                ${makeDateCell3("followUpDate", row.followUpDate || "")}
                ${makeDropdownCell3("followUpResponse", row.followUpResponse || "", null, dropdowns3.followUpResponse)}
                ${makeNumberCell3("resumeCount", row.resumeCount || "")}
                ${makeDateCell3("resumeDate", row.resumeDate || "")}
                ${makeDateCell3("expectedResponseDate", row.expectedResponseDate || "")}
                </tr>`;
                tbody.append(tr);
            });

            attachCellEvents3();
            attachSendMailEvents3();
            setStickyColumns3();
        }

        function renderPagination3() {
            const totalPages = Math.ceil(filteredData3.length / rowsPerPage3);
            const pagination = $("#pagination3");
            pagination.empty();

            const visiblePageCount = 3;
            let startPage = Math.max(currentPage3 - 1, 1);
            let endPage = startPage + visiblePageCount - 1;
            if (endPage > totalPages) {
                endPage = totalPages;
                startPage = Math.max(endPage - visiblePageCount + 1, 1);
            }

            const prevDisabled = currentPage3 === 1 ? 'disabled' : '';
            const nextDisabled = currentPage3 === totalPages ? 'disabled' : '';

            pagination.append(`<li><a href="javascript:void(0);" class="${prevDisabled}" onclick="changePage3(${currentPage3 - 1})">&laquo;</a></li>`);

            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage3 ? "active" : "";
                pagination.append(`<li><a href="javascript:void(0);" class="${active}" onclick="changePage3(${i})">${i}</a></li>`);
            }

            pagination.append(`<li><a href="javascript:void(0);" class="${nextDisabled}" onclick="changePage3(${currentPage3 + 1})">&raquo;</a></li>`);
        }

        window.changePage3 = function (page) {
            const totalPages = Math.ceil(filteredData3.length / rowsPerPage3);
            if (page < 1 || page > totalPages) return;
            currentPage3 = page;
            renderTable3();
            renderPagination3();
        };

        function renderColumnFilters3() {
            const headerRow = $("#leadsTable3 thead tr.filters");
            headerRow.remove();

            let filterRow = "<tr class='filters'>";
            $("#leadsTable3 thead tr:first th").each(function (i, th) {
                if (i === 0 || i === 1 || i === 20) {
                    filterRow += "<th></th>";
                } else {
                    filterRow += `<th>
                    <select class="column-filter3 form-select form-select-sm" data-index="${i}">
                        <option value="">All</option>
                    </select>
                </th>`;
                }
            });
            filterRow += "</tr>";
            $("#leadsTable3 thead").append(filterRow);

            populateColumnFilterOptions3();

            $(".column-filter3").off("change").on("change", function () {
                applyFilters3();
            });
        }

        function populateColumnFilterOptions3() {
            $("#leadsTable3 thead .column-filter3").each(function () {
                const index = $(this).data("index");
                const colName = $("#leadsTable3 thead th").eq(index).text().trim().toLowerCase();

                const isDateColumn =
                    colName.includes("date") ||
                    colName.includes("response") ||
                    colName.includes("created");

                const isNumericColumn =
                    colName.includes("no. of resumes") || colName.includes("number of resumes");

                let values = [...new Set(tableData3.map(row => {
                    let v = Object.values(row)[index];
                    if (v === null || v === undefined || v === "") return "";
                    if (typeof v === "string") v = v.trim();
                    if (isNumericColumn) {
                        v = parseInt(v, 10);
                        if (isNaN(v)) return "";
                    }
                    return v;
                }))];

                values = values.filter(v => v !== "" && v !== null && v !== undefined);

                values.sort((a, b) => {
                    if (isDateColumn) {
                        const da = new Date(a), db = new Date(b);
                        if (!isNaN(da) && !isNaN(db)) return da - db;
                    }
                    if (isNumericColumn) {
                        return a - b;
                    }
                    return a.toString().localeCompare(b.toString());
                });

                values.forEach(v => {
                    let displayText = v;
                    if (isDateColumn) {
                        const d = new Date(v);
                        if (!isNaN(d)) {
                            displayText = d.toLocaleDateString("en-GB", {
                                day: "numeric",
                                month: "long",
                                year: "numeric"
                            });
                        }
                    }
                    $(this).append(`<option value="${v}">${displayText}</option>`);
                });
            });
        }

        function applyFilters3() {
            filteredData3 = [...tableData3];
            $("#leadsTable3 thead .column-filter3").each(function () {
                const value = $(this).val();
                const index = $(this).data("index");
                if (value) {
                    filteredData3 = filteredData3.filter(row => {
                        const cellValue = Object.values(row)[index] || "";
                        return cellValue.toLowerCase() === value.toLowerCase();
                    });
                }
            });
            currentPage3 = 1;
            renderTable3();
            renderPagination3();
        }

        function makeNumberCell3(field, value) {
            let displayValue = value || "";
            return `<td data-field="${field}">
            <span>${displayValue}</span>
            <input type="number" value="${displayValue}">
        </td>`;
        }

        function makeDateCell3(field, value) {
            let displayValue = formatDate3(value);
            let rawValue = value ? new Date(value).toISOString().split("T")[0] : "";
            return `<td data-field="${field}">
            <span>${displayValue}</span>
            <input type="text" class="date-picker3" value="${rawValue}">
        </td>`;
        }

        function makeDropdownCell3(field, selectedValue, stateFilter = null, optionsList = null) {
            let options = optionsList || dropdowns3[field] || [];
            function capitalize(str) {
                return str.replace(/\b\w/g, c => c.toUpperCase());
            }
            let displaySelected = selectedValue ? capitalize(selectedValue) : "";
            let html = `<td data-field="${field}">
            <span style="font-weight:bold;">${displaySelected}</span>
            <select class="form-control select33">`;
            html += `<option value="" ${!selectedValue ? "selected" : ""}></option>`;
            options.forEach(opt => {
                let sel = (opt === selectedValue) ? "selected" : "";
                html += `<option value="${opt}" ${sel}>${capitalize(opt)}</option>`;
            });
            html += `</select></td>`;
            return html;
        }

        function formatDate3(dateStr) {
            if (!dateStr) return "";
            let date = new Date(dateStr);
            if (isNaN(date)) return dateStr;
            return date.toLocaleDateString("en-GB", {
                day: "numeric",
                month: "long",
                year: "numeric"
            });
        }

        function attachCellEvents3() {
            $("#leadsTable3 td").off("dblclick").on("dblclick", function () {
                let td = $(this);
                td.addClass("editing");
                td.find("input,select").focus();
            });

            $("#leadsTable3 td[data-field='mobileNumber']").off("dblclick").on("dblclick", function (e) {
                e.preventDefault();
                let td = $(this);
                td.addClass("editing");
                td.find("input").focus();
            });

            $("#leadsTable3 td input, #leadsTable3 td select")
                .off("blur change")
                .on("blur change", function () {
                    if ($(this).hasClass("date-picker3")) return;
                    let td = $(this).closest("td");
                    let tr = $(this).closest("tr");
                    let id = tr.data("id");
                    let field = td.data("field");
                    let value = $(this).val();

                    function capitalize(str) {
                        return str.replace(/\b\w/g, c => c.toUpperCase());
                    }

                    if ($(this).is("select")) {
                        let displayText = capitalize(value);
                        let bgColor = "";
                        if (colorMap3[field] && value) {
                            bgColor = colorMap3[field][value.toLowerCase()] || "";
                        }
                        td.css("background-color", bgColor);
                        td.find("span").css("color", "black").css("font-weight", "bold").text(displayText);
                    } else {
                        td.find("span").text(value);
                    }
                    td.removeClass("editing");

                    let payload = {};
                    payload[field] = value;

                    let userData3 = JSON.parse(sessionStorage.getItem("user_data"));
                    if (userData3 && userData3.user_id) {
                        payload["userId"] = userData3.user_id;
                    }

                    $.ajax({
                        url: `https://fundsaudit.com/api/v1/resumedetails/update/` + id,
                        method: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(payload),
                        success: function (res) {
                            console.log("Payload3:", payload);
                            console.log("Updated3:", res);
                            if (field === "state") {
                                const cityTd = tr.find("td[data-field='city']");
                                const newCityDropdown = makeDropdownCell3("city", "", value);
                                cityTd.replaceWith(newCityDropdown);
                                attachCellEvents3();
                            }
                        },
                        error: function (err) {
                            console.error("Update3 failed", err);
                            console.log("Payload3:", payload);
                        }
                    });
                });

            $(".date-picker3").each(function () {
                const input = $(this);
                input.flatpickr({
                    dateFormat: "Y-m-d",
                    onChange: function (selectedDates, dateStr) {
                        if (!dateStr) return;
                        let td = input.closest("td");
                        let tr = input.closest("tr");
                        let id = tr.data("id");
                        let field = td.data("field");
                        let value = new Date(dateStr).toISOString().split("T")[0];

                        td.find("span").text(formatDate3(value));
                        td.removeClass("editing");

                        let payload = {};
                        payload[field] = value;

                        let userData3 = JSON.parse(sessionStorage.getItem("user_data"));
                        if (userData3 && userData3.user_id) {
                            payload["userId"] = userData3.user_id;
                        }

                        $.ajax({
                            url: `https://fundsaudit.com/api/v1/resumedetails/update/` + id,
                            method: "PUT",
                            contentType: "application/json",
                            data: JSON.stringify(payload),
                            success: function (res) {
                                console.log("Updated3:", res);
                            },
                            error: function (err) {
                                console.error("Update3 failed", err);
                            }
                        });
                    }
                });
            });
        }

        function attachSendMailEvents3() {
            $(".send-mail3").off("click").on("click", function () {
                const id = $(this).data("id");
                Swal.fire({
                    title: "Are you sure?",
                    text: "Do you want to send the JD mail?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonText: "Yes, Send",
                    cancelButtonText: "Cancel"
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: "Sending...",
                            text: "Please wait while the mail is being sent",
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        $.ajax({
                            url: "https://fundsaudit.com/api/v1/cosheet/" + id + "/send-jd",
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({ cc: [], bcc: [], userId: userData.user_id }),
                            success: function (res) {
                                Swal.fire({
                                    icon: "success",
                                    title: "Mail Sent!",
                                    text: "The JD mail was sent successfully."
                                });
                            },
                            error: function (err) {
                                Swal.fire({
                                    icon: "error",
                                    title: "Error",
                                    text: "Failed to send the JD mail."
                                });
                            }
                        });
                    }
                });
            });
        }

        window.filterTable3 = function () {
            const value = $("#searchInput3").val().toLowerCase().trim();
            if (!value) {
                renderTable3();
                renderPagination3();
                return;
            }

            const filtered = tableData3.filter((row) =>
                Object.values(row).some((field) => {
                    const plainText = $('<div>').html(field).text().toLowerCase().trim();
                    return plainText.includes(value);
                })
            );

            const tbody = $("#leadsTable3 tbody");
            tbody.empty();
            filtered.forEach((row, index) => {
                const tr = `<tr data-id="${row.id}">
                    <td>
                    <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
                <td>${row.sno}</td>

                <!-- keep all these NON-editable / dropdown as before -->
                <td>${row.collegeName || ""}</td>
                <td>${row.coordinatorName || ""}</td>
                <td>${row.mobileNumber || ""}</td>
                <td>${row.emailId || ""}</td>
                <td>${row.state || ""}</td>
                <td>${row.city || ""}</td>
                <td>${row.course || ""}</td>
                <td>${row.connectedBy || ""}</td>
                <td>${row.dateOfConnect || ""}</td>
                <td>${row.callResponse || ""}</td>
                <td>${row.internshipType || ""}</td>
                <td>${row.detailedResponse || ""}</td>
                ${makeDropdownCell("followUpBy", row.followUpBy || "", null, dropdowns.connectedBy)}
                ${makeDateCell("followUpDate", row.followUpDate || "")}
                ${makeDropdownCell("followUpResponse", row.followUpResponse || "", null, dropdowns.followUpResponse)}
                ${makeNumberCell("resumeCount", row.resumeCount || "")}
                ${makeDateCell("resumeDate", row.resumeDate || "")}
                ${makeDateCell("expectedResponseDate", row.expectedResponseDate || "")}
                
                </tr>`;
                tbody.append(tr);
            });

            $("#pagination3").hide();
            attachCellEvents3();
            attachSendMailEvents3();
        };

        window.printTable3 = function () {
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print Table</title></head><body>');
            printWindow.document.write($("#leadsTable2")[0].outerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        };

        window.exportToExcel3 = function () {
            const headers = [
                "S No.",
                "College Name",
                "Coordinator Name",
                "Mobile Number",
                "Email ID",
                "State",
                "City",
                "Course",
                "Connected By",
                "Date of Connect",
                "Call Response",
                "Internship Type",
                "Detailed Response",
                "Follow up by",
                "Follow up date",
                "Follow up response",
                "Resume count",
                "Resume date",
                "Expected response date"
            ];

            const data = [headers];

            tableData3.forEach((row, index) => {
                data.push([
                    index + 1,
                    row.collegeName,
                    row.coordinatorName,
                    row.mobileNumber,
                    row.emailId,
                    row.state,
                    row.city,
                    row.course,
                    row.connectedBy,
                    row.dateOfConnect,
                    row.callResponse,
                    row.internshipType,
                    row.detailedResponse,
                    row.followUpBy,
                    row.followUpDate,
                    row.followUpResponse,
                    row.resumeCount,
                    row.resumeCount,
                    row.expectedResponseDate
                ]);
            });

            const worksheet = XLSX.utils.aoa_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "CollegeDetails");
            XLSX.writeFile(workbook, "RE_Individual.xlsx");
        };

        $(document).ready(function () {
            loadCities3().then(() => {
                loadTableData3();
            });
        });
    </script>

    <script>
        let selectedMonthYear3 = "";

        (function populateYearMonthDropdowns3() {
            const yearSelect = document.getElementById("yearSelect3");
            const monthSelect = document.getElementById("monthSelect3");

            const now = new Date();
            let currentYear = now.getFullYear();

            for (let y = currentYear - 2; y <= currentYear + 2; y++) {
                let option = document.createElement("option");
                option.value = y;
                option.textContent = y;
                if (y === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            }

            let emptyOption = document.createElement("option");
            emptyOption.value = "";
            emptyOption.textContent = "Select Month";
            emptyOption.selected = true;
            monthSelect.appendChild(emptyOption);

            for (let m = 1; m <= 12; m++) {
                let option = document.createElement("option");
                option.value = String(m).padStart(2, "0");
                let d = new Date(2000, m - 1, 1);
                option.textContent = d.toLocaleDateString("en-GB", { month: "long" });
                monthSelect.appendChild(option);
            }

            selectedMonthYear3 = "";
            document.getElementById("selectedMonthDisplay3").style.display = "none";

            console.log("Initial Selection: All data (no month filter)");
            filteredData3 = [...tableData3];
            renderTable3();
            renderPagination3();
        })();

        function setSelectedMonthYear3() {
            const year = document.getElementById("yearSelect3").value;
            const month = document.getElementById("monthSelect3").value;
            const display = document.getElementById("selectedMonthDisplay3");

            if (year && month) {
                selectedMonthYear3 = `${year}-${month}`;
                let d = new Date(year, month - 1, 1);
                display.textContent = d.toLocaleDateString("en-GB", { month: "long", year: "numeric" });
                display.style.display = "inline-block";

                console.log("Selected Month-Year:", selectedMonthYear3);

                filteredData3 = tableData3.filter(row => {
                    if (!row.followUpDate) return false;
                    let d = new Date(row.followUpDate);
                    if (isNaN(d)) return false;
                    let ym = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}`;
                    return ym === selectedMonthYear3;
                });
            } else {
                selectedMonthYear3 = "";
                display.style.display = "none";
                filteredData3 = [...tableData3];
                console.log("Selection cleared, showing all data...");
            }

            currentPage3 = 1;
            renderTable3();
            renderPagination3();
        }
    </script>

    <script>
        document.addEventListener("click", function (e) {
            if (e.target.closest(".delete-record")) {
                let button = e.target.closest(".delete-record");
                let recordId = button.getAttribute("data-id");

                Swal.fire({
                    title: "Are you sure?",
                    text: "This action cannot be undone!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    cancelButtonColor: "#6c757d",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        console.log("Deleting record with ID:", recordId);

                        $.ajax({
                            url: `https://fundsaudit.com/api/v1/cosheet/cosheet/${recordId}`,
                            method: "DELETE",
                            success: function (res) {
                                Swal.fire(
                                    "Deleted!",
                                    "The record has been deleted.",
                                    "success"
                                ).then(() => {
                                    $(button).closest("tr").remove();
                                });
                            },
                            error: function (err) {
                                console.error("Delete failed", err);
                                Swal.fire(
                                    "Error!",
                                    "Failed to delete the record.",
                                    "error"
                                );
                            }
                        });
                    }
                });
            }
        });
    </script>

    <script>
        var userData = JSON.parse(sessionStorage.getItem("user_data"));
        console.log(userData);

        let analysisChart = null;

        function formatDateUI(dateStr) {
            const parts = dateStr.split("-");
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1]}-${parts[0]}`;
            }
            return dateStr;
        }

        function loadDashboardData(startDate = null, endDate = null) {
            let url = `https://fundsaudit.com/api/v1/resumedetails/analysis/${userData.user_id}`;

            if (startDate && endDate) {
                url += `?fromDate=${startDate}&toDate=${endDate}`;
            }

            $.ajax({
                url: url,
                type: "GET",
                success: function (response) {
                    console.log("RE top metrics:", response);
                    if (response.success) {
                        const totals = response.totals;
                        const breakdown = totals.breakdownTotals || {};

                        $("#totalFollowups").text(totals.totalAchievedFollowUps || 0);
                        $("#targetFollowups").text(totals.totalFollowUpTarget || 0);

                        let followupsPercent = (totals.totalFollowUpTarget > 0)
                            ? ((totals.totalAchievedFollowUps / totals.totalFollowUpTarget) * 100).toFixed(1)
                            : 0;
                        $("#followupsPercent").text(followupsPercent + "%");

                        $("#totalResumes").text(totals.totalAchievedResumes || 0);
                        $("#targetResumes").text(totals.totalResumeTarget || 0);

                        let resumesPercent = (totals.totalResumeTarget > 0)
                            ? ((totals.totalAchievedResumes / totals.totalResumeTarget) * 100).toFixed(1)
                            : 0;
                        $("#resumesPercent").text(resumesPercent + "%");

                        $("#sendingCount").text(breakdown["sending in 1-2 days"] || 0);
                        $("#delayCount").text(breakdown["delayed"] || 0);
                        $("#noresponseCount").text(breakdown["no response"] || 0);
                        $("#unprofessionalCount").text(breakdown["unprofessional"] || 0);

                        const base = totals.totalFollowUpTarget || 1;
                        $("#sendingPercent").text(((breakdown["sending in 1-2 days"] || 0) / base * 100).toFixed(1) + "%");
                        $("#delayPercent").text(((breakdown["delayed"] || 0) / base * 100).toFixed(1) + "%");
                        $("#noresponsePercent").text(((breakdown["no response"] || 0) / base * 100).toFixed(1) + "%");
                        $("#unprofessionalPercent").text(((breakdown["unprofessional"] || 0) / base * 100).toFixed(1) + "%");

                        let remainingFollowups = Math.max(totals.totalFollowUpTarget - totals.totalAchievedFollowUps, 0);
                        $("#remainingCalls").text(remainingFollowups);

                        $("#achievementPercent2").text(followupsPercent + "%");

                        let card = $("#remainingCallsCard");
                        card.removeClass("bg-danger bg-warning bg-success text-white text-dark");

                        if (totals.totalFollowUpTarget === 0) {
                            card.addClass("bg-white text-dark");
                        } else if (followupsPercent < 33) {
                            card.addClass("bg-danger text-white");
                        } else if (followupsPercent <= 66) {
                            card.addClass("bg-warning text-white");
                        } else {
                            card.addClass("bg-success text-white");
                        }
                    }
                },
                error: function (err) {
                    console.error("Error fetching dashboard data", err);
                }
            });
        }

        function loadAnalysisChart(startDate = null, endDate = null) {
            let url = `https://fundsaudit.com/api/v1/resumedetails/analysis-per-cosheet/${userData.user_id}`;

            if (startDate && endDate) {
                url += `?fromDate=${startDate}&toDate=${endDate}&period=daily`;
            }

            $.ajax({
                url: url,
                type: "GET",
                dataType: "json",
                success: function (res) {
                    console.log("Resume Analysis Data:", res);
                    const jdList = $("#jdList");
                    jdList.empty();

                    if (res.success && res.analysis && res.analysis.length > 0) {
                        const breakdown = res.analysis;

                        const dates = breakdown.map(item => {
                            let d = new Date(item.period);
                            let day = d.getDate();
                            return `${day}`;
                        });

                        const resumeCounts = breakdown.map(item => item.resumes_recieved || 0);

                        breakdown.forEach(item => {
                            let target = item.resumetarget || 0;
                            jdList.append(`
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>${formatDateUI(item.period)}</span>
                            <span class="fw-bold">${item.resumes_recieved}/${target}</span>
                        </li>
                    `);
                        });

                        if (analysisChart) {
                            analysisChart.updateOptions({
                                series: [{ name: "Resumes Received", data: resumeCounts }],
                                xaxis: { categories: dates }
                            });
                        } else {
                            analysisChart = new ApexCharts(document.querySelector("#conversion-statistic-bar-chart"), {
                                series: [{ name: "Resumes Received", data: resumeCounts }],
                                chart: { type: "bar", height: 200, toolbar: { show: false } },
                                plotOptions: { bar: { horizontal: false, endingShape: "rounded", columnWidth: "20%" } },
                                colors: ["#fff"],
                                grid: { show: false },
                                legend: { show: false },
                                dataLabels: { enabled: false },
                                xaxis: {
                                    categories: dates,
                                    labels: {
                                        show: true,
                                        style: { colors: "#fff", fontFamily: "Roboto" }
                                    },
                                    axisBorder: { show: false }
                                },
                                yaxis: { labels: { show: false } },
                                tooltip: {
                                    theme: "dark",
                                    y: { formatter: (val) => val + " Resumes" },
                                    style: { colors: "#000", fontFamily: "Roboto" }
                                }
                            });
                            analysisChart.render();
                        }
                    } else {
                        console.warn("No resume analysis data found for selected range.");
                        jdList.append(`<li><span class="date">No Data</span><span class="count">0/0</span></li>`);
                        if (analysisChart) {
                            analysisChart.updateOptions({
                                series: [{ name: "Resumes Received", data: [] }],
                                xaxis: { categories: [] }
                            });
                        }
                    }
                },
                error: function (err) {
                    console.error("Error fetching resume analysis data", err);
                }
            });
        }

        $(document).ready(function () {
            loadDashboardData();
            loadAnalysisChart();
        });
    </script>

    <script>
        let fromDate = null;
        let toDate = null;

        flatpickr("#dateRangePicker", {
            mode: "range",
            dateFormat: "Y-m-d",
            onClose: function (selectedDates, dateStr, instance) {
                if (selectedDates.length === 2) {
                    fromDate = instance.formatDate(selectedDates[0], "Y-m-d");
                    toDate = instance.formatDate(selectedDates[1], "Y-m-d");

                    console.log("From:", fromDate, "To:", toDate);

                    loadDashboardData(fromDate, toDate);
                    loadAnalysisChart(fromDate, toDate);
                }
            }
        });
    </script>

    <script>
        let fromDate2 = null;
        let toDate2 = null;

        flatpickr("#dateRangePicker2", {
            mode: "range",
            dateFormat: "Y-m-d",
            onClose: function (selectedDates, dateStr, instance) {
                if (selectedDates.length === 2) {
                    fromDate2 = instance.formatDate(selectedDates[0], "Y-m-d");
                    toDate2 = instance.formatDate(selectedDates[1], "Y-m-d");

                    console.log("Date Range 2:", "From:", fromDate2, "To:", toDate2);

                    loadCounts2(fromDate2, toDate2);
                }
            }
        });

        function loadCounts2(startDate = null, endDate = null) {
            let url = `https://fundsaudit.com/api/v1/resumedetails/analysis/${userData.user_id}`;

            if (startDate && endDate) {
                url += `?fromDate=${startDate}&toDate=${endDate}`;
            }

            $.ajax({
                url: url,
                type: "GET",
                success: function (response) {
                    console.log("Metrics 2:", response);
                    if (response.success) {
                        const totals = response.totals || {};
                        const breakdown = totals.breakdownTotals || {};

                        $("#totalResumes2").text(totals.totalAchievedResumes || 0);
                        let resumesPercent = (totals.totalResumeTarget > 0)
                            ? ((totals.totalAchievedResumes / totals.totalResumeTarget) * 100).toFixed(1)
                            : 0;
                        $("#resumesPercent2").text(resumesPercent + "%");

                        $("#sendingCount2").text(breakdown["sending in 1-2 days"] || 0);
                        $("#delayCount2").text(breakdown["delayed"] || 0);
                        $("#noresponseCount2").text(breakdown["no response"] || 0);
                        $("#unprofessionalCount2").text(breakdown["unprofessional"] || 0);

                        const base = totals.totalResumeTarget || 1;
                        $("#sendingPercent2").text(((breakdown["sending in 1-2 days"] || 0) / base * 100).toFixed(1) + "%");
                        $("#delayPercent2").text(((breakdown["delayed"] || 0) / base * 100).toFixed(1) + "%");
                        $("#noresponsePercent2").text(((breakdown["no response"] || 0) / base * 100).toFixed(1) + "%");
                        $("#unprofessionalPercent2").text(((breakdown["unprofessional"] || 0) / base * 100).toFixed(1) + "%");
                    }
                },
                error: function (err) {
                    console.error("Error fetching data (Picker 2)", err);
                }
            });
        }

        $(document).ready(function () {
            loadCounts2();
        });
    </script>

</body>

</html>